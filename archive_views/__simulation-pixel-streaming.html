<div class="bg-gray-100">
  <div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg">
      <h1 class="text-3xl font-bold text-center mb-6">
        VM Streaming and Video Chat
      </h1>

      <div class="mb-8">
        <h2 class="text-xl font-semibold mb-4">Remote Desktop Stream</h2>
        <video
          id="remoteVideo"
          class="w-full h-auto bg-black"
          autoplay
          playsinline
        ></video>
      </div>

      <div class="mb-8">
        <h2 class="text-xl font-semibold mb-4">Controls</h2>
        <button
          id="startButton"
          class="bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors"
        >
          Start Stream
        </button>
        <button
          id="stopButton"
          class="bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors ml-4"
        >
          Stop Stream
        </button>
      </div>

      <div>
        <h2 class="text-xl font-semibold mb-4">Simulation Controls</h2>
        <!-- Add your simulation controls here -->
      </div>
    </div>
  </div>

  <script>
    let peerConnection;
    let dataChannel;
    const ws = new WebSocket("ws://" + window.location.host + "/websocket");

    ws.onmessage = function (event) {
      const message = JSON.parse(event.data);
      if (message.type === "ice") {
        peerConnection.addIceCandidate(new RTCIceCandidate(message.ice));
      }
      // Handle other message types as needed
    };

    document
      .getElementById("startButton")
      .addEventListener("click", startStream);
    document.getElementById("stopButton").addEventListener("click", stopStream);

    async function startStream() {
      peerConnection = new RTCPeerConnection({
        iceServers: [{ urls: "stun:stun.l.google.com:19302" }],
      });

      peerConnection.ontrack = function (event) {
        document.getElementById("remoteVideo").srcObject = event.streams[0];
      };

      peerConnection.onicecandidate = function (event) {
        if (event.candidate) {
          ws.send(
            JSON.stringify({
              type: "ice",
              ice: event.candidate,
            }),
          );
        }
      };

      dataChannel = peerConnection.createDataChannel("signaling");
      dataChannel.onopen = function () {
        console.log("Data channel is open");
      };

      const offer = await peerConnection.createOffer();
      await peerConnection.setLocalDescription(offer);
      ws.send(
        JSON.stringify({
          type: "offer",
          offer: offer,
        }),
      );
    }

    function stopStream() {
      if (peerConnection) {
        peerConnection.close();
      }
      document.getElementById("remoteVideo").srcObject = null;
    }
  </script>
</div>
