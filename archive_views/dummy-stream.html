<link href="/static/css/output.css" rel="stylesheet" />
<!-- TODO make not scroll -->
<div class="flex">
  <div class="w-1/2">
    <!-- <img
      id="webcam-image"
      src="https://hashirama.blog/static/external/webcam.jpg"
      class="w-full"
    /> -->
    <!--       <!-- src="http://hashrama.blog/sensor_data/latest-webcam" -->
    <img
      id="liveImage"
      src="https://files.hashirama.blog/sensor_data/webcam/20240919_212625.jpg"
      alt="Live Image"
      width="640"
      height="480"
    />
  </div>
  <div class="w-1/2">
    <img
      id="jupyter-webcam-image"
      src="http://hashirama.blog/static/sensor_data/mutated_webcam/20240919_212635.jpg"
      class="w-full"
    />
  </div>
  <!-- <canvas></canvas> -->
</div>

<script>
  async function refreshImage() {
    const imageElement = document.getElementById("liveImage");
    const timestamp = new Date().getTime(); // Current timestamp to prevent caching
    imageElement.src = `http://hashirama.blog/sensor_data/latest-webcam?t=${timestamp}`;

    const imageMutateElement = document.getElementById("jupyter-webcam-image");

    const response = await fetch(url);
    const html = await response.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, "text/html");
    // const links = doc.querySelectorAll(".file a");
    let table = Array.from(doc.querySelectorAll(".file"));
    //console.log(table);
    table.sort((a, b) => {
      let dateA = new Date(a.children[3].textContent);
      let dateB = new Date(b.children[3].textContent);
      console.log(dateB - dateA);
      return dateB - dateA;
    });
    //console.log(doc);
    //window.doc = doc;
    let mostRecent = table[0].children[1].firstElementChild.href;

    let mutant_webcam_url = `https://files.hashirama.blog/sensor_data/mutated_webcam/${mostRecent.split("/").slice(-1)}`;
    console.log(mutant_webcam_url);

    imageMutateElement.href = mutant_webcam_url;

    //const allLinks = Array.from(links).map((link) => link.href);
    //console.log("All links:", allLinks);

    // You can do further processing with the links here
    // For example, you could update the image source with the latest link
    // if (allLinks.length > 0) {
    //   const latestLink = allLinks[allLinks.length - 1];
    //   imageMutateElement.src = latestLink;
    // }
    // })
    // .catch((error) =>
    //   console.error("Error fetching or parsing HTML:", error),
    // );

    //imageMutateElement.src = `http://hashrama.blog/sensor_data/latest-mutated-webcam`;
  }

  // Refresh the image every 50 milliseconds (20 frames per second)
  // setInterval(refreshImage, 50);

  let url = "https://files.hashirama.blog/sensor_data/mutated_webcam/";
  // function reloadImages() {
  //   // document.getElementById("webcam-image").src =
  //   //     "/static/external/webcam.jpg?" + new Date().getTime();
  //   // document.getElementById("jupyter-webcam-image").src =
  //   //     "/static/external/jupyter_webcam.jpg?" + new Date().getTime();
  //   document.getElementById("webcam-image").src =
  //     "https://hashirama.blog/static/webcam.jpg?";
  //   document.getElementById("jupyter-webcam-image").src =
  //     "https://hashirama.blog/static/jupyter_webcam.jpg";

  //   console.log("reloading");
  // }

  // setInterval(reloadImages, 16);
</script>

<!-- webcam -> websocket -> server -->
<!-- server -> http -> send image to jupyter -->
<!-- jupyter writes to disk -->
<!-- server displays both prev image + annotations -->

<!-- can you use stereoscopic camera to generate depth imaging / lidar  -->
<!-- should i get a ldiar??? -->
