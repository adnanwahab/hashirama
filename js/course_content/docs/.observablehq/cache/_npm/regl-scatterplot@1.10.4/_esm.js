/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/regl-scatterplot@1.10.4/dist/regl-scatterplot.esm.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import e from"../pub-sub-es@3.0.0/_esm.js";import t from"../regl@2.1.0/_esm.js";const n=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,o=e=>e,r=(e,t=(e=>e))=>{const n=[];for(let o=0;o<e;o++)n.push(t(o,e));return n},i=(e,...t)=>(t.forEach((t=>{const n=Object.keys(t).reduce(((e,n)=>(e[n]=Object.getOwnPropertyDescriptor(t,n),e)),{});Object.getOwnPropertySymbols(t).forEach((e=>{const o=Object.getOwnPropertyDescriptor(t,e);o.enumerable&&(n[e]=o)})),Object.defineProperties(e,n)})),e),a=(e,t)=>n=>i(n,{get[e](){return t}}),s=(e=1)=>new Promise((t=>{let n=0;const o=()=>requestAnimationFrame((()=>{n++,n<e?o():t()}));o()})),l=(e,t,n=null)=>{let o,r=0;n=null===n?t:n;const i=(...t)=>{clearTimeout(o),o=setTimeout((()=>{r>0&&(e(...t),r=0)}),n)};let a=!1;const s=(...n)=>{a?(r++,i(...n)):(e(...n),i(...n),a=!0,r=0,setTimeout((()=>{a=!1}),t))};return s.reset=()=>{a=!1},s.cancel=()=>{clearTimeout(o)},s.now=(...t)=>e(...t),s};var c,d="undefined"!=typeof Float32Array?Float32Array:Array;function u(){var e=new d(16);return d!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function p(e){var t=new d(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function m(e,t){var n=t[0],o=t[1],r=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],d=t[8],u=t[9],p=t[10],m=t[11],h=t[12],f=t[13],y=t[14],g=t[15],v=n*s-o*a,w=n*l-r*a,x=n*c-i*a,b=o*l-r*s,E=o*c-i*s,S=r*c-i*l,A=d*f-u*h,I=d*y-p*h,P=d*g-m*h,M=u*y-p*f,C=u*g-m*f,T=p*g-m*y,R=v*T-w*C+x*M+b*P-E*I+S*A;return R?(R=1/R,e[0]=(s*T-l*C+c*M)*R,e[1]=(r*C-o*T-i*M)*R,e[2]=(f*S-y*E+g*b)*R,e[3]=(p*E-u*S-m*b)*R,e[4]=(l*P-a*T-c*I)*R,e[5]=(n*T-r*P+i*I)*R,e[6]=(y*x-h*S-g*w)*R,e[7]=(d*S-p*x+m*w)*R,e[8]=(a*C-s*P+c*A)*R,e[9]=(o*P-n*C-i*A)*R,e[10]=(h*E-f*x+g*v)*R,e[11]=(u*x-d*E-m*v)*R,e[12]=(s*I-a*M-l*A)*R,e[13]=(n*M-o*I+r*A)*R,e[14]=(f*w-h*b-y*v)*R,e[15]=(d*b-u*w+p*v)*R,e):null}function h(e,t,n){var o=t[0],r=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],d=t[7],u=t[8],p=t[9],m=t[10],h=t[11],f=t[12],y=t[13],g=t[14],v=t[15],w=n[0],x=n[1],b=n[2],E=n[3];return e[0]=w*o+x*s+b*u+E*f,e[1]=w*r+x*l+b*p+E*y,e[2]=w*i+x*c+b*m+E*g,e[3]=w*a+x*d+b*h+E*v,w=n[4],x=n[5],b=n[6],E=n[7],e[4]=w*o+x*s+b*u+E*f,e[5]=w*r+x*l+b*p+E*y,e[6]=w*i+x*c+b*m+E*g,e[7]=w*a+x*d+b*h+E*v,w=n[8],x=n[9],b=n[10],E=n[11],e[8]=w*o+x*s+b*u+E*f,e[9]=w*r+x*l+b*p+E*y,e[10]=w*i+x*c+b*m+E*g,e[11]=w*a+x*d+b*h+E*v,w=n[12],x=n[13],b=n[14],E=n[15],e[12]=w*o+x*s+b*u+E*f,e[13]=w*r+x*l+b*p+E*y,e[14]=w*i+x*c+b*m+E*g,e[15]=w*a+x*d+b*h+E*v,e}function f(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function y(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function g(e,t,n){var o=t[0],r=t[1],i=t[2],a=t[3];return e[0]=n[0]*o+n[4]*r+n[8]*i+n[12]*a,e[1]=n[1]*o+n[5]*r+n[9]*i+n[13]*a,e[2]=n[2]*o+n[6]*r+n[10]*i+n[14]*a,e[3]=n[3]*o+n[7]*r+n[11]*i+n[15]*a,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),c=new d(4),d!=Float32Array&&(c[0]=0,c[1]=0,c[2]=0,c[3]=0),function(){var e=function(){var e=new d(2);return d!=Float32Array&&(e[0]=0,e[1]=0),e}()}();const v=(e=[0,0],t=1,n=0,o=[0,0],r=[[0,1/0],[0,1/0]],i=[[-1/0,1/0],[-1/0,1/0]])=>{const a=new Float32Array(16),s=new Float32Array(16),l=new Float32Array(16);let c=u(),d=[...o.slice(0,2),0,1];const p=Array.isArray(r[0])?[...r[0]]:[...r],v=Array.isArray(r[0])?[...r[1]]:[...r],w=Array.isArray(i[0])?[...i[0]]:[...i],x=Array.isArray(i[0])?[...i[1]]:[...i],b=()=>function(e,t){var n=t[0],o=t[1],r=t[2],i=t[4],a=t[5],s=t[6],l=t[8],c=t[9],d=t[10];return e[0]=Math.hypot(n,o,r),e[1]=Math.hypot(i,a,s),e[2]=Math.hypot(l,c,d),e}(a,c).slice(0,2),E=()=>{const e=b();return Math.min(e[0],e[1])},S=()=>{const e=b();return Math.max(e[0],e[1])},A=([e=0,t=0]=[],n=1,o=0)=>{c=u(),I([-e,-t]),M(o),P(1/n)},I=([e=0,t=0]=[])=>{a[0]=e,a[1]=t,a[2]=0;const n=f(s,a);h(c,n,c)},P=(e,t)=>{const n=Array.isArray(e);let o=n?e[0]:e,r=n?e[1]:e;if(o<=0||r<=0||1===o&&1===r)return;const i=b(),u=i[0]*o,g=i[1]*r;if(o=Math.max(p[0],Math.min(u,p[1]))/i[0],r=Math.max(v[0],Math.min(g,v[1]))/i[1],1===o&&1===r)return;a[0]=o,a[1]=r,a[2]=1;const w=y(s,a),x=t?[...t,0]:d,E=f(a,x);h(c,E,h(c,w,h(c,m(l,E),c)))},M=e=>{const t=u();!function(e,t,n){var o,r,i,a=n[0],s=n[1],l=n[2],c=Math.hypot(a,s,l);c<1e-6||(a*=c=1/c,s*=c,l*=c,o=Math.sin(t),i=1-(r=Math.cos(t)),e[0]=a*a*i+r,e[1]=s*a*i+l*o,e[2]=l*a*i-s*o,e[3]=0,e[4]=a*s*i-l*o,e[5]=s*s*i+r,e[6]=l*s*i+a*o,e[7]=0,e[8]=a*l*i+s*o,e[9]=s*l*i-a*o,e[10]=l*l*i+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1)}(t,e,[0,0,1]),h(c,t,c)},C=e=>{!e||e.length<16||(c=e)};return A(e,t,n),{get translation(){return function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}(a,c).slice(0,2)},get target(){return g(a,d,m(l,c)).slice(0,2)},get scaling(){return b()},get minScaling(){return E()},get maxScaling(){return S()},get scaleBounds(){return[[...p],[...v]]},get translationBounds(){return[[...w],[...x]]},get distance(){return(()=>{const e=b();return[1/e[0],1/e[1]]})()},get minDistance(){return 1/E()},get maxDistance(){return 1/S()},get rotation(){return Math.acos(c[0]/S())},get view(){return c},get viewCenter(){return d.slice(0,2)},lookAt:A,translate:I,pan:I,rotate:M,scale:P,zoom:P,reset:()=>{A(e,t,n)},set:(...e)=>(console.warn("`set()` is deprecated. Please use `setView()` instead."),C(...e)),setScaleBounds:e=>{const t=Array.isArray(e[0]);p[0]=t?e[0][0]:e[0],p[1]=t?e[0][1]:e[1],v[0]=t?e[1][0]:e[0],v[1]=t?e[1][1]:e[1]},setTranslationBounds:e=>{const t=Array.isArray(e[0]);w[0]=t?e[0][0]:e[0],w[1]=t?e[0][1]:e[1],x[0]=t?e[1][0]:e[0],x[1]=t?e[1][1]:e[1]},setView:C,setViewCenter:e=>{d=[...e.slice(0,2),0,1]}}},w=["pan","rotate"],x={alt:"altKey",cmd:"metaKey",ctrl:"ctrlKey",meta:"metaKey",shift:"shiftKey"},b=(e,{distance:t=1,target:n=[0,0],rotation:o=0,isNdc:r=!0,isFixed:i=!1,isPan:a=!0,isPanInverted:s=[!1,!0],panSpeed:l=1,isRotate:c=!0,rotateSpeed:d=1,defaultMouseDownMoveAction:u="pan",mouseDownMoveModKey:p="alt",isZoom:m=!0,zoomSpeed:h=1,viewCenter:f,scaleBounds:y,translationBounds:g,onKeyDown:b=(()=>{}),onKeyUp:E=(()=>{}),onMouseDown:S=(()=>{}),onMouseUp:A=(()=>{}),onMouseMove:I=(()=>{}),onWheel:P=(()=>{})}={})=>{let M=v(n,t,o,f,y,g),C=0,T=0,R=0,L=0,D=0,B=0,O=!1,z=0,$=1,N=1,F=1,k=!1,_=!1,j=!1,W="pan"===u,V=a,Z=a,U=s,G=s,Y=m,K=m;const q=()=>{V=Array.isArray(a)?Boolean(a[0]):a,Z=Array.isArray(a)?Boolean(a[1]):a,U=Array.isArray(s)?Boolean(s[0]):s,G=Array.isArray(s)?Boolean(s[1]):s,Y=Array.isArray(m)?Boolean(m[0]):m,K=Array.isArray(m)?Boolean(m[1]):m};q();const H=r?e=>e/$*2*F:e=>e,X=r?e=>e/N*2:e=>-e,J=r?e=>(e/$*2-1)*F:e=>e,Q=r?e=>1-e/N*2:e=>e,ee=()=>{const t=e.getBoundingClientRect();$=t.width,N=t.height,F=$/N},te=e=>{j=!1,E(e)},ne=e=>{j=e[x[p]],b(e)},oe=e=>{O=!1,A(e)},re=e=>{O=1===e.buttons,S(e)},ie=void 0!==document.createEvent("MouseEvent").offsetX?e=>{R=e.offsetX,L=e.offsetY}:t=>{const n=e.getBoundingClientRect();R=t.clientX-n.left,L=t.clientY-n.top},ae=e=>{C=e.clientX,T=e.clientY},se=e=>{ae(e),I(e)},le=e=>{if(Y||K){e.preventDefault(),ae(e),ie(e);const t=1===e.deltaMode?12:1;z+=t*(e.deltaY||e.deltaX||0)}P(e)};window.addEventListener("keydown",ne,{passive:!0}),window.addEventListener("keyup",te,{passive:!0}),e.addEventListener("mousedown",re,{passive:!0}),window.addEventListener("mouseup",oe,{passive:!0}),window.addEventListener("mousemove",se,{passive:!0}),e.addEventListener("wheel",le,{passive:!1}),M.config=({defaultMouseDownMoveAction:e=null,isFixed:t=null,isPan:n=null,isPanInverted:o=null,isRotate:r=null,isZoom:f=null,panSpeed:y=null,rotateSpeed:g=null,zoomSpeed:v=null,mouseDownMoveModKey:b=null}={})=>{u=null!==e&&w.includes(e)?e:u,W="pan"===u,i=null!==t?t:i,a=null!==n?n:a,s=null!==o?o:s,c=null!==r?r:c,m=null!==f?f:m,l=+y>0?y:l,d=+g>0?g:d,h=+v>0?v:h,q(),p=null!==b&&Object.keys(x).includes(b)?b:p},M.dispose=()=>{M=void 0,window.removeEventListener("keydown",ne),window.removeEventListener("keyup",te),e.removeEventListener("mousedown",re),window.removeEventListener("mouseup",oe),window.removeEventListener("mousemove",se),e.removeEventListener("wheel",le)},M.refresh=ee,M.tick=()=>{if(i){const e=_;return _=!1,e}k=!1;const e=C,t=T;if((V||Z)&&O&&(W&&!j||!W&&j)){const n=V?H(l*(U?D-e:e-D)):0,o=Z?X(l*(G?B-t:t-B)):0;0===n&&0===o||(M.pan([n,o]),k=!0)}if((Y||K)&&z){const e=h*Math.exp(z/N),t=J(R),n=Q(L);M.scale([Y?1/e:1,K?1/e:1],[t,n]),k=!0}if(c&&O&&(W&&j||!W&&!j)&&Math.abs(D-e)+Math.abs(B-t)>0){const n=$/2,o=N/2,r=D-n,i=o-B,a=e-n,s=o-t,l=function(e,t){var n=e[0],o=e[1],r=t[0],i=t[1],a=Math.sqrt(n*n+o*o)*Math.sqrt(r*r+i*i),s=a&&(n*r+o*i)/a;return Math.acos(Math.min(Math.max(s,-1),1))}([r,i],[a,s]),c=r*s-a*i;M.rotate(d*l*Math.sign(c)),k=!0}z=0,D=e,B=t;const n=k||_;return _=!1,n};const ce=e=>function(){e.apply(null,arguments),_=!0};return M.lookAt=ce(M.lookAt),M.translate=ce(M.translate),M.pan=ce(M.pan),M.rotate=ce(M.rotate),M.scale=ce(M.scale),M.zoom=ce(M.zoom),M.reset=ce(M.reset),M.set=ce(M.set),M.setScaleBounds=ce(M.setScaleBounds),M.setTranslationBounds=ce(M.setTranslationBounds),M.setView=ce(M.setView),M.setViewCenter=ce(M.setViewCenter),ee(),M},E=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),S=Float32Array.BYTES_PER_ELEMENT,A=e=>e.length>0&&Array.isArray(e[0]),{push:I,splice:P}=Array.prototype;function M(e,t=1,n=1){const o=[],r=new Array(2*t);for(let i=0,a=e.length/t;i<a;i++){const a=i*t;for(let o=0;o<t;o++){const i=e[a+o];r[o]=i,r[o+t]=i*n}I.apply(o,r)}return o}function C(e,t,n,o){const r=new Array(o),i=t*o;for(let t=0;t<o;t++)r[t]=e[i+t];return P.call(e,n*o,0,...r),e}const T=(e,{projection:t=E,model:n=E,view:o=E,points:r=[],colorIndices:i=[],color:a=[.8,.5,0,1],opacity:s=null,opacities:l=[],width:c=1,widths:d=[],miter:u=!0,is2d:p=!1,zPos2d:m=0}={})=>{if(!e)return void console.error("Regl instance is undefined.");const f=new Float32Array(16);let y,g,v,w,x,b,P,T,R,L,D,B,O,z,$,N,F,k,_=p?2:3;const j=()=>+(l.length===g||null!==s),W=()=>{L=e.buffer(),D=e.buffer(),B=e.buffer(),$=e.buffer(),N={prevPosition:{buffer:()=>L,offset:0,stride:3*S},currPosition:{buffer:()=>L,offset:3*S*2,stride:3*S},nextPosition:{buffer:()=>L,offset:3*S*4,stride:3*S},opacity:{buffer:()=>D,offset:2*S,stride:S},offsetScale:{buffer:()=>B,offset:2*S,stride:S},colorIndex:{buffer:()=>$,offset:2*S,stride:S}},F=e.elements(),k=e({attributes:N,depth:{enable:!p},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},uniforms:{projectionViewModel:(e,t)=>{const n=e.projection||t.projection,o=e.model||t.model,r=e.view||t.view;return h(f,n,h(f,r,o))},aspectRatio:({viewportWidth:e,viewportHeight:t})=>e/t,colorTex:()=>O,colorTexRes:()=>z,colorTexEps:()=>.5/z,pixelRatio:({pixelRatio:e})=>e,width:({pixelRatio:e,viewportHeight:t})=>c/t*e,useOpacity:j,useColorOpacity:()=>Number(!j()),miter:Number(Boolean(u))},elements:()=>F,vert:"\nuniform mat4 projectionViewModel;\nuniform float aspectRatio;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform float width;\nuniform float useOpacity;\nuniform float useColorOpacity;\nuniform int miter;\n\nattribute vec3 prevPosition;\nattribute vec3 currPosition;\nattribute vec3 nextPosition;\nattribute float opacity;\nattribute float offsetScale;\nattribute float colorIndex;\n\nvarying vec4 color;\n\nvoid main() {\n  vec2 aspectVec = vec2(aspectRatio, 1.0);\n  vec4 prevProjected = projectionViewModel * vec4(prevPosition, 1.0);\n  vec4 currProjected = projectionViewModel * vec4(currPosition, 1.0);\n  vec4 nextProjected = projectionViewModel * vec4(nextPosition, 1.0);\n\n  // get 2D screen space with W divide and aspect correction\n  vec2 prevScreen = prevProjected.xy / prevProjected.w * aspectVec;\n  vec2 currScreen = currProjected.xy / currProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n\n  float len = width;\n\n  // starting point uses (next - current)\n  vec2 dir = vec2(0.0);\n  if (currScreen == prevScreen) {\n    dir = normalize(nextScreen - currScreen);\n  }\n  // ending point uses (current - previous)\n  else if (currScreen == nextScreen) {\n    dir = normalize(currScreen - prevScreen);\n  }\n  // somewhere in middle, needs a join\n  else {\n    // get directions from (C - B) and (B - A)\n    vec2 dirA = normalize((currScreen - prevScreen));\n    if (miter == 1) {\n      vec2 dirB = normalize((nextScreen - currScreen));\n      // now compute the miter join normal and length\n      vec2 tangent = normalize(dirA + dirB);\n      vec2 perp = vec2(-dirA.y, dirA.x);\n      vec2 miter = vec2(-tangent.y, tangent.x);\n      len = width / dot(miter, perp);\n      dir = tangent;\n    } else {\n      dir = dirA;\n    }\n  }\n\n  vec2 normal = vec2(-dir.y, dir.x) * len;\n  normal.x /= aspectRatio;\n  vec4 offset = vec4(normal * offsetScale, 0.0, 0.0);\n  gl_Position = currProjected + offset;\n\n  // Get color from texture\n  float colorRowIndex = floor((colorIndex + colorTexEps) / colorTexRes);\n  vec2 colorTexIndex = vec2(\n    (colorIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n  color.a = useColorOpacity * color.a + useOpacity * opacity;\n}",frag:"\nprecision mediump float;\nvarying vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}"})},V=()=>{1===y&&r.length%_>0&&console.warn(`The length of points (${g}) does not match the dimensions (${_}). Incomplete points are ignored.`),w=r.flat().slice(0,g*_),p&&(w=function(e,t,n,o=0){const r=[],i=new Array(n).fill(o);for(let n=0,o=e.length/t;n<o;n++){const o=n*t;for(let n=0;n<t;n++)i[n]=e[o+n];I.apply(r,i)}return r}(w,2,3,m)),i.length!==g&&(i=new Array(g).fill(0)),d.length!==g&&(d=new Array(g).fill(1));const e=i.slice(),t=l.length===g?l.slice():new Array(g).fill(null===s?1:s),n=d.slice();let o=0;for(const r of v){const i=o+r-1;C(w,i,i,3),C(w,o,o,3),C(e,i,i,1),C(e,o,o,1),C(t,i,i,1),C(t,o,o,1),C(n,i,i,1),C(n,o,o,1),o+=r+2}x=new Float32Array(M(w,3)),b=M(e),P=M(t),T=M(n,1,-1),R=((e,t=[])=>{let n=0;for(const o of e){for(let e=0;e<o-1;e++){const o=n+2*e,r=o+1,i=o+2,a=o+3;t.push(o,r,i,i,r,a)}n+=2*(o+2)}return t})(v),L({usage:"dynamic",type:"float",length:x.length*S,data:x}),D({usage:"dynamic",type:"float",length:P.length*S,data:P}),B({usage:"dynamic",type:"float",length:T.length*S,data:T}),$({usage:"dynamic",type:"float",length:b.length*S,data:b}),F({primitive:"triangles",usage:"dynamic",type:R.length>65536?"uint32":"uint16",data:R})},Z=()=>{U(),W()},U=()=>{r=[],w=[],x=new Float32Array,T=[],R=[],L.destroy(),B.destroy(),F.destroy()},G=(e,t)=>{const n=t.flat(2);return n.length===g?n:n.length===y?v.flatMap(((e,t)=>Array(e).fill(n[t]))):e},Y=(e=[],{colorIndices:t=i,opacities:n=l,widths:o=d,is2d:a=p}={})=>{_=(p=a)?2:3,y=A(r=e)?r.length:1,v=A(r)?r.map((e=>Math.floor(e.length/_))):[Math.floor(r.length/_)],g=v.reduce(((e,t)=>e+t),0),i=G(i,t),l=G(l,n),d=G(d,o),r&&g>1?V():Z()},K=()=>{const t=A(a)?a:[a];z=Math.max(2,Math.ceil(Math.sqrt(t.length)));const n=new Uint8Array(z**2*4);t.forEach(((e,t)=>{n[4*t]=Math.min(255,Math.max(0,Math.round(255*e[0]))),n[4*t+1]=Math.min(255,Math.max(0,Math.round(255*e[1]))),n[4*t+2]=Math.min(255,Math.max(0,Math.round(255*e[2]))),n[4*t+3]=Number.isNaN(+e[3])?255:Math.min(255,Math.max(0,Math.round(255*e[3])))})),O=e.texture({data:n,shape:[z,z,4]})};return W(),K(),r&&r.length>1&&Y(r),{clear:Z,destroy:U,draw:({projection:e,model:i,view:a}={})=>{e&&(t=e),i&&(n=i),a&&(o=a),r&&r.length>1&&k({projection:t,model:n,view:o})},getPoints:()=>r,setPoints:Y,getData:()=>({points:x,widths:T,opacities:P,colorIndices:b}),getBuffer:()=>({points:L,widths:B,opacities:D,colorIndices:$}),getStyle:()=>({color:a,miter:u,width:c}),setStyle:({color:e,opacity:t,miter:n,width:o}={})=>{var r;e&&((e,t=s)=>{a=e,s=t,O&&O.destroy(),K()})(e,t||s),n&&(u=Boolean(n)),void 0!==(r=o)&&Number.isFinite(r)&&(c=o)}}};
/**
 * KDBush - A fast static index for 2D points
 * @license ISC License
 * @copyright Vladimir Agafonkin 2018
 * @version 4.0.2
 * @see https://github.com/mourner/kdbush/
 */var R=()=>{const e=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class t{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,r]=new Uint8Array(n,0,2);if(219!==o)throw new Error("Data does not appear to be in a KDBush format.");const i=r>>4;if(1!==i)throw new Error(`Got v${i} data when expected v1.`);const a=e[15&r];if(!a)throw new Error("Unrecognized array type.");const[s]=new Uint16Array(n,2,1),[l]=new Uint32Array(n,4,1);return new t(l,s,a,n)}constructor(t,n=64,o=Float64Array,r){if(isNaN(t)||t<0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const i=e.indexOf(this.ArrayType),a=2*t*this.ArrayType.BYTES_PER_ELEMENT,s=t*this.IndexArrayType.BYTES_PER_ELEMENT,l=(8-s%8)%8;if(i<0)throw new Error(`Unexpected typed array class: ${o}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+l,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+a+s+l),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+s+l,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(e,t){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=t,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return n(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:r,coords:i,nodeSize:a}=this,s=[0,r.length-1,0],l=[];for(;s.length;){const c=s.pop()||0,d=s.pop()||0,u=s.pop()||0;if(d-u<=a){for(let a=u;a<=d;a++){const s=i[2*a],c=i[2*a+1];s>=e&&s<=n&&c>=t&&c<=o&&l.push(r[a])}continue}const p=u+d>>1,m=i[2*p],h=i[2*p+1];m>=e&&m<=n&&h>=t&&h<=o&&l.push(r[p]),(0===c?e<=m:t<=h)&&(s.push(u),s.push(p-1),s.push(1-c)),(0===c?n>=m:o>=h)&&(s.push(p+1),s.push(d),s.push(1-c))}return l}within(e,t,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:r,nodeSize:i}=this,s=[0,o.length-1,0],l=[],c=n*n;for(;s.length;){const d=s.pop()||0,u=s.pop()||0,p=s.pop()||0;if(u-p<=i){for(let n=p;n<=u;n++)a(r[2*n],r[2*n+1],e,t)<=c&&l.push(o[n]);continue}const m=p+u>>1,h=r[2*m],f=r[2*m+1];a(h,f,e,t)<=c&&l.push(o[m]),(0===d?e-n<=h:t-n<=f)&&(s.push(p),s.push(m-1),s.push(1-d)),(0===d?e+n>=h:t+n>=f)&&(s.push(m+1),s.push(u),s.push(1-d))}return l}}function n(e,t,r,i,a,s){if(a-i<=r)return;const l=i+a>>1;o(e,t,l,i,a,s),n(e,t,r,i,l-1,1-s),n(e,t,r,l+1,a,1-s)}function o(e,t,n,i,a,s){for(;a>i;){if(a-i>600){const r=a-i+1,l=n-i+1,c=Math.log(r),d=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*d*(r-d)/r)*(l-r/2<0?-1:1);o(e,t,n,Math.max(i,Math.floor(n-l*d/r+u)),Math.min(a,Math.floor(n+(r-l)*d/r+u)),s)}const l=t[2*n+s];let c=i,d=a;for(r(e,t,i,n),t[2*a+s]>l&&r(e,t,i,a);c<d;){for(r(e,t,c,d),c++,d--;t[2*c+s]<l;)c++;for(;t[2*d+s]>l;)d--}t[2*i+s]===l?r(e,t,i,d):(d++,r(e,t,d,a)),d<=n&&(i=d+1),n<=d&&(a=d-1)}}function r(e,t,n,o){i(e,n,o),i(t,2*n,2*o),i(t,2*n+1,2*o+1)}function i(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}function a(e,t,n,o){const r=e-n,i=t-o;return r*r+i*i}return t},L=()=>{addEventListener("message",(e=>{const t=e.data.points;t.length||self.postMessage({error:new Error("Invalid point data")});const n=new KDBush(t.length,e.data.nodeSize);for(const[e,o]of t)n.add(e,o);n.finish(),postMessage(n.data,[n.data])}))};const D=R(),B=(e,t={nodeSize:16,useWorker:void 0})=>new Promise(((n,o)=>{if(e instanceof ArrayBuffer)n(D.from(e));else if((e.length<1e6||!1===t.useWorker)&&!0!==t.useWorker){const o=new D(e.length,t.nodeSize);for(const t of e)o.add(t[0],t[1]);o.finish(),n(o)}else{const r=(e=>{const t=`const createKDBushClass = ${R.toString()};KDBush = createKDBushClass();const createWorker = ${e.toString()};createWorker();`;return new Worker(window.URL.createObjectURL(new Blob([t],{type:"text/javascript"})))})(L);r.onmessage=e=>{e.data.error?o(e.data.error):n(D.from(e.data)),r.terminate()},r.postMessage({points:e,nodeSize:t.nodeSize})}})),O="auto",z=Float32Array.BYTES_PER_ELEMENT,$=["OES_texture_float","OES_element_index_uint","WEBGL_color_buffer_float","EXT_float_blend"],N={color:[0,0,0,0],depth:1},F="panZoom",k="lasso",_="rotate",j=[F,k,_],W=F,V={cubicIn:e=>e*e*e,cubicInOut:n,cubicOut:e=>--e*e*e+1,linear:e=>e,quadIn:e=>e*e,quadInOut:e=>e<.5?2*e*e:(4-2*e)*e-1,quadOut:e=>e*(2-e)},Z=n,U="continuous",G="categorical",Y=[U,G],K="deselect",q="lassoEnd",H=[K,q],X=[0,.666666667,1,1],J=2,Q=!1,ee=10,te=3,ne=q,oe=!1,re=750,ie=500,ae=100,se=250,le="lasso",ce="rotate",de="merge",ue=[le,ce,de],pe="alt",me="cmd",he="ctrl",fe="meta",ye="shift",ge=[pe,me,he,fe,ye],ve={[pe]:ce,[ye]:le,[me]:de},we=O,xe=O,be=1,Ee=6,Se=2,Ae=2,Ie=null,Pe=2,Me=2,Ce=null,Te=null,Re=null,Le=.66,De=null,Be=.15,Oe=25,ze=1,$e=1,Ne=null,Fe=[.66,.66,.66,1],ke=[0,.55,1,1],_e=[1,1,1,1],je=[0,0,0,1],We=null,Ve=[.66,.66,.66,.2],Ze=[0,.55,1,1],Ue=[1,1,1,1],Ge=[1,1,1,.5],Ye=1,Ke=1e3,qe=[0,0],He=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Xe=null,Je=!1,Qe=[1,1,1,.5],et=!0,tt=!0,nt=!1,ot=100,rt=.002,it="auto",at=!1,st=new Set(["z","valueZ","valueA","value1","category"]),lt=new Set(["w","valueW","valueB","value2","value"]),ct=void 0,dt="Points have not been drawn",ut=(e,t)=>`${e}ms ease-out effectIn ${t}ms 1 normal forwards`,pt=(e,t)=>`${e}ms linear leftSpinIn ${t}ms 1 normal forwards`,mt=(e,t)=>`${e}ms linear rightSpinIn ${t}ms 1 normal forwards`,ht=(e,t)=>`${e}ms linear circleIn ${t}ms 1 normal forwards`,ft=(e,t,n)=>`\n  @keyframes mainIn {\n    0% {\n      color: ${t};\n      opacity: 0;\n    }\n    0%, ${e}% {\n      color: ${t};\n      opacity: 1;\n    }\n    100% {\n      color: ${n};\n      opacity: 0.8;\n    }\n  }\n`,yt=(e,t,n,o)=>`\n  @keyframes effectIn {\n    0%, ${e}% {\n      opacity: ${n};\n      transform: scale(${o});\n    }\n    ${t}% {\n      opacity: 0.66;\n      transform: scale(1.5);\n    }\n    99% {\n      opacity: 0;\n      transform: scale(2);\n    }\n    100% {\n      opacity: 0;\n      transform: scale(0);\n    }\n  }\n`,gt=(e,t)=>`\n  @keyframes leftSpinIn {\n    0% {\n      transform: rotate(${t}deg);\n    }\n    ${e}%, 100% {\n      transform: rotate(360deg);\n    }\n  }\n`,vt=(e,t)=>`\n  @keyframes rightSpinIn {\n    0% {\n      transform: rotate(${t}deg);\n    }\n    ${e}%, 100% {\n      transform: rotate(180deg);\n    }\n  }\n`,wt=e=>`${e}ms linear effectOut 0s 1 normal forwards`,xt=e=>`${e}ms linear leftSpinOut 0s 1 normal forwards`,bt=e=>`${e}ms linear rightSpinOut 0s 1 normal forwards`,Et=e=>`${e}ms linear circleOut 0s 1 normal forwards`,St=(e,t)=>`\n  @keyframes mainOut {\n    0% {\n      color: ${e};\n    }\n    100% {\n      color: ${t};\n    }\n  }\n`,At=(e,t)=>`\n  @keyframes rightSpinOut {\n    0%, ${e}% {\n      transform: rotate(${t}deg);\n    }\n    100% {\n      transform: rotate(0deg);\n    }\n`,It=e=>`\n  @keyframes leftSpinOut {\n    0% {\n      transform: rotate(${e}deg);\n    }\n    100% {\n      transform: rotate(0deg);\n    }\n  }\n`,Pt=(e,t,n)=>`\n  @keyframes circleOut {\n    0%, ${e}% {\n      clip-path: ${t};\n      opacity: ${n};\n    }\n    ${e+.01}% {\n      clip-path: inset(0 0 0 50%);\n      opacity: ${n};\n    }\n    100% {\n      clip-path: inset(0 0 0 50%);\n      opacity: 0;\n    }\n  }\n`,Mt=(e,t=null)=>null===e?t:e;let Ct;const Tt=()=>{if(!Ct){const e=document.createElement("style");document.head.appendChild(e),Ct=e.sheet}return Ct},Rt=e=>{const t=Tt(),n=t.rules.length;return t.insertRule(e,n),n},Lt=e=>{Tt().deleteRule(e)};let Dt=null;let Bt=null;const Ot=(e,{onDraw:t=o,onStart:n=o,onEnd:r=o,enableInitiator:c=true,initiatorParentElement:d=document.body,longPressIndicatorParentElement:u=document.body,minDelay:p=8,minDist:m=2,pointNorm:h=o}={})=>{let f=c,y=d,g=u,v=t,w=n,x=r,b=h;const E=document.createElement("div"),S=Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5);E.id=`lasso-initiator-${S}`,E.style.position="fixed",E.style.display="flex",E.style.justifyContent="center",E.style.alignItems="center",E.style.zIndex=99,E.style.width="4rem",E.style.height="4rem",E.style.borderRadius="4rem",E.style.opacity=.5,E.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)";const{longPress:A,longPressCircle:I,longPressCircleLeft:P,longPressCircleRight:M,longPressEffect:C}=(()=>{const e=document.createElement("div"),t=Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5);e.id=`lasso-long-press-${t}`,e.style.position="fixed",e.style.width="1.25rem",e.style.height="1.25rem",e.style.pointerEvents="none",e.style.transform="translate(-50%,-50%)";const n=document.createElement("div");n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.width="1.25rem",n.style.height="1.25rem",n.style.clipPath="inset(0px 0px 0px 50%)",n.style.opacity=0,e.appendChild(n);const o=document.createElement("div");o.style.position="absolute",o.style.top=0,o.style.left=0,o.style.width="0.8rem",o.style.height="0.8rem",o.style.border="0.2rem solid currentcolor",o.style.borderRadius="0.8rem",o.style.clipPath="inset(0px 50% 0px 0px)",o.style.transform="rotate(0deg)",n.appendChild(o);const r=document.createElement("div");r.style.position="absolute",r.style.top=0,r.style.left=0,r.style.width="0.8rem",r.style.height="0.8rem",r.style.border="0.2rem solid currentcolor",r.style.borderRadius="0.8rem",r.style.clipPath="inset(0px 50% 0px 0px)",r.style.transform="rotate(0deg)",n.appendChild(r);const i=document.createElement("div");return i.style.position="absolute",i.style.top=0,i.style.left=0,i.style.width="1.25rem",i.style.height="1.25rem",i.style.borderRadius="1.25rem",i.style.background="currentcolor",i.style.transform="scale(0)",i.style.opacity=0,e.appendChild(i),{longPress:e,longPressCircle:n,longPressCircleLeft:o,longPressCircleRight:r,longPressEffect:i}})();let T,R=!1,L=!1,D=[],B=[],O=!1,z=null,$=null,N=null,F=null,k=null,_=null,j=null,W=null,V=null,Z=null;const U=()=>{R=!1};window.addEventListener("mouseup",U);const G=()=>{E.style.opacity=.5,E.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)"},Y=(e,t)=>{const n=getComputedStyle(e),o=+n.opacity,r=n.transform.match(/([0-9.-]+)+/g),i=+r[0],a=+r[1],s=Math.sqrt(i*i+a*a);let l=Math.atan2(a,i)*(180/Math.PI);return l=t&&l<=0?360+l:l,{opacity:o,scale:s,rotate:l}},K=e=>{if(!f||R)return;const t=e.clientX,n=e.clientY;E.style.top=`${n}px`,E.style.left=`${t}px`;const o=Y(E),r=o.opacity,i=o.scale,a=o.rotate;E.style.opacity=r,E.style.transform=`translate(-50%,-50%) scale(${i}) rotate(${a}deg)`,E.style.animation="none",s().then((()=>{null!==Dt&&Lt(Dt),Dt=Rt(((e,t,n)=>`\n@keyframes scaleInFadeOut {\n  0% {\n    opacity: ${e};\n    transform: translate(-50%,-50%) scale(${t}) rotate(${n}deg);\n  }\n  10% {\n    opacity: 1;\n    transform: translate(-50%,-50%) scale(1) rotate(${n+20}deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0.9) rotate(${n+60}deg);\n  }\n}\n`)(r,i,a)),E.style.animation="2500ms ease scaleInFadeOut 0s 1 normal backwards",s().then((()=>{G()}))}))},q=()=>{const{opacity:e,scale:t,rotate:n}=Y(E);E.style.opacity=e,E.style.transform=`translate(-50%,-50%) scale(${t}) rotate(${n}deg)`,E.style.animation="none",s(2).then((()=>{null!==Bt&&Lt(Bt),Bt=Rt(((e,t,n)=>`\n@keyframes fadeScaleOut {\n  0% {\n    opacity: ${e};\n    transform: translate(-50%,-50%) scale(${t}) rotate(${n}deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0) rotate(${n}deg);\n  }\n}\n`)(e,t,n)),E.style.animation="250ms ease fadeScaleOut 0s 1 normal backwards",s().then((()=>{G()}))}))},H=(e,t,{time:n=re,extraTime:o=ie,delay:r=ae}={time:re,extraTime:ie,delay:ae})=>{O=!0;const i=getComputedStyle(A);A.style.color=i.color,A.style.top=`${t}px`,A.style.left=`${e}px`,A.style.animation="none";const a=getComputedStyle(I);I.style.clipPath=a.clipPath,I.style.opacity=a.opacity,I.style.animation="none";const l=Y(C);C.style.opacity=l.opacity,C.style.transform=`scale(${l.scale})`,C.style.animation="none";const c=Y(P);P.style.transform=`rotate(${c.rotate}deg)`,P.style.animation="none";const d=Y(M);M.style.transform=`rotate(${d.rotate}deg)`,M.style.animation="none",s().then((()=>{if(!O)return;null!==k&&Lt(k),null!==F&&Lt(F),null!==N&&Lt(N),null!==$&&Lt($),null!==z&&Lt(z);const{rules:e,names:t}=(({time:e=re,extraTime:t=ie,delay:n=ae,currentColor:o,targetColor:r,effectOpacity:i,effectScale:a,circleLeftRotation:s,circleRightRotation:l,circleClipPath:c,circleOpacity:d})=>{const u=s/360,p=((e,t,n)=>(1-e)*t+n)(u,e,t),m=Math.round((1-u)*e/p*100),h=Math.round(m/2),f=m+(100-m)/4;return{rules:{main:ft(m,o,r),effect:yt(m,f,i,a),circleRight:vt(h,l),circleLeft:gt(m,s),circle:(v=h,w=c,x=d,`\n  @keyframes circleIn {\n    0% {\n      clip-path: ${w};\n      opacity: ${x};\n    }\n    ${v}% {\n      clip-path: ${w};\n      opacity: 1;\n    }\n    ${v+.01}%, 100% {\n      clip-path: inset(0);\n      opacity: 1;\n    }\n  }\n`)},names:{main:(y=p,g=n,`${y}ms ease-out mainIn ${g}ms 1 normal forwards`),effect:ut(p,n),circleLeft:pt(p,n),circleRight:mt(p,n),circle:ht(p,n)}};var y,g,v,w,x})({time:n,extraTime:o,delay:r,currentColor:i.color||"currentcolor",targetColor:A.dataset.activeColor,effectOpacity:l.opacity||0,effectScale:l.scale||0,circleLeftRotation:c.rotate||0,circleRightRotation:d.rotate||0,circleClipPath:a.clipPath||"inset(0 0 0 50%)",circleOpacity:a.opacity||0});z=Rt(e.main),$=Rt(e.effect),N=Rt(e.circleLeft),F=Rt(e.circleRight),k=Rt(e.circle),A.style.animation=t.main,C.style.animation=t.effect,P.style.animation=t.circleLeft,M.style.animation=t.circleRight,I.style.animation=t.circle}))},X=({time:e=se}={time:se})=>{if(!O)return;O=!1;const t=getComputedStyle(A);A.style.color=t.color,A.style.animation="none";const n=getComputedStyle(I);I.style.clipPath=n.clipPath,I.style.opacity=n.opacity,I.style.animation="none";const o=Y(C);C.style.opacity=o.opacity,C.style.transform=`scale(${o.scale})`,C.style.animation="none";const r="x"===n.clipPath.slice(-2,-1),i=Y(P,r);P.style.transform=`rotate(${i.rotate}deg)`,P.style.animation="none";const a=Y(M);M.style.transform=`rotate(${a.rotate}deg)`,M.style.animation="none",s().then((()=>{null!==Z&&Lt(Z),null!==V&&Lt(V),null!==W&&Lt(W),null!==j&&Lt(j),null!==_&&Lt(_);const{rules:r,names:s}=(({time:e=se,currentColor:t,targetColor:n,effectOpacity:o,effectScale:r,circleLeftRotation:i,circleRightRotation:a,circleClipPath:s,circleOpacity:l})=>{const c=i/360,d=c*e,u=Math.min(100,100*c),p=u>50?Math.round(100*(1-50/u)):0;return{rules:{main:St(t,n),effect:(h=o,f=r,`\n  @keyframes effectOut {\n    0% {\n      opacity: ${h};\n      transform: scale(${f});\n    }\n    99% {\n      opacity: 0;\n      transform: scale(${f+.5});\n    }\n    100% {\n      opacity: 0;\n      transform: scale(0);\n    }\n  }\n`),circleRight:At(p,a),circleLeft:It(i),circle:Pt(p,s,l)},names:{main:(m=d,`${m}ms linear mainOut 0s 1 normal forwards`),effect:wt(d),circleRight:xt(d),circleLeft:bt(d),circle:Et(d)}};var m,h,f})({time:e,currentColor:t.color||"currentcolor",targetColor:A.dataset.color,effectOpacity:o.opacity||0,effectScale:o.scale||0,circleLeftRotation:i.rotate||0,circleRightRotation:a.rotate||0,circleClipPath:n.clipPath||"inset(0px)",circleOpacity:n.opacity||1});_=Rt(r.main),j=Rt(r.effect),W=Rt(r.circleLeft),V=Rt(r.circleRight),Z=Rt(r.circle),A.style.animation=s.main,C.style.animation=s.effect,P.style.animation=s.circleLeft,M.style.animation=s.circleRight,I.style.animation=s.circle}))},J=()=>{v(D,B)},Q=e=>{if(T){if((t=e[0],n=e[1],o=T[0],r=T[1],Math.sqrt((t-o)**2+(n-r)**2))>2){T=e;const t=b(e);D.push(t),B.push(t[0],t[1]),D.length>1&&J()}}else{L||(L=!0,w()),T=e;const t=b(e);D=[t],B=[t[0],t[1]]}var t,n,o,r},ee=l(Q,8,8),te=(t,n)=>{const o=(t=>{const{left:n,top:o}=e.getBoundingClientRect();return[t.clientX-n,t.clientY-o]})(t);return n?ee(o):Q(o)},ne=()=>{D=[],B=[],T=void 0,J()},oe=e=>{K(e)},le=()=>{R=!0,L=!0,ne(),w()},ce=()=>{q()},de=({merge:e=!1}={})=>{L=!1;const t=[...D],n=[...B];return ee.cancel(),ne(),t.length&&x(t,n,{merge:e}),t},ue=({onDraw:e=null,onStart:t=null,onEnd:n=null,enableInitiator:o=null,initiatorParentElement:r=null,longPressIndicatorParentElement:i=null,minDelay:a=null,minDist:s=null,pointNorm:l=null}={})=>{v=Mt(e,v),w=Mt(t,w),x=Mt(n,x),f=Mt(o,f),b=Mt(l,b),null!==r&&r!==y&&(y.removeChild(E),r.appendChild(E),y=r),null!==i&&i!==g&&(g.removeChild(A),i.appendChild(A),g=i),f?(E.addEventListener("click",oe),E.addEventListener("mousedown",le),E.addEventListener("mouseleave",ce)):(E.removeEventListener("mousedown",le),E.removeEventListener("mouseleave",ce))},pe=()=>{y.removeChild(E),g.removeChild(A),window.removeEventListener("mouseup",U),E.removeEventListener("click",oe),E.removeEventListener("mousedown",le),E.removeEventListener("mouseleave",ce)};return y.appendChild(E),g.appendChild(A),ue({onDraw:v,onStart:w,onEnd:x,enableInitiator:f,initiatorParentElement:y}),((...e)=>t=>e.reduce(((e,t)=>t(e)),t))(a("initiator",E),a("longPressIndicator",A),(e=>i(e,{clear:ne,destroy:pe,end:de,extend:te,set:ue,showInitiator:K,hideInitiator:q,showLongPressIndicator:H,hideLongPressIndicator:X})),(me=Ot,e=>i({__proto__:{constructor:me}},e)))({});var me},zt=(e,t)=>!!e&&$.reduce(((n,o)=>e.hasExtension(o)?n:(t||console.warn(`WebGL: ${o} extension not supported. Scatterplot might not render properly`),!1)),!0),$t=e=>{const n=e.getContext("webgl",{antialias:!0,preserveDrawingBuffer:!0}),o=[];for(const e of $)n.getExtension(e)?o.push(e):console.warn(`WebGL: ${e} extension not supported. Scatterplot might not render properly`);return t({gl:n,extensions:o})},Nt=(e,t,n,o)=>Math.sqrt((e-n)**2+(t-o)**2),Ft=(e,t=!1)=>e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,n,o)=>`#${t}${t}${n}${n}${o}${o}`)).substring(1).match(/.{2}/g).map((e=>Number.parseInt(e,16)/255**t)),kt=(e,t,{minLength:n=0}={})=>Array.isArray(e)&&e.length>=n&&e.every(t),_t=e=>!Number.isNaN(+e)&&+e>=0,jt=e=>!Number.isNaN(+e)&&+e>0,Wt=(e,t)=>n=>e.indexOf(n)>=0?n:t,Vt=(e,t,n=15e3)=>new Promise(((o,r)=>{((e,t=!1,n=15e3)=>new Promise(((o,r)=>{const i=new Image;t&&(i.crossOrigin="anonymous"),i.src=e,i.onload=()=>{o(i)};const a=()=>{r(new Error("IMAGE_LOAD_ERROR"))};i.onerror=a,setTimeout(a,n)})))(t,0!==t.indexOf(window.location.origin)&&-1===t.indexOf("base64"),n).then((t=>{o(e.texture(t))})).catch((e=>{r(e)}))})),Zt=e=>e>=0&&e<=1,Ut=e=>Array.isArray(e)&&e.every(Zt),Gt=(e,[t,n]=[])=>{let o,r,i,a,s=!1;for(let l=0,c=e.length-2;l<e.length;l+=2)o=e[l],r=e[l+1],i=e[c],a=e[c+1],r>n!=a>n&&t<(i-o)*(n-r)/(a-r)+o&&(s=!s),c=l;return s},Yt=e=>"string"==typeof e||e instanceof String,Kt=e=>Number.isInteger(e)&&e>=0&&e<=255,qt=e=>Array.isArray(e)&&e.every(Kt),Ht=e=>Array.isArray(e)&&e.length&&(Array.isArray(e[0])||Yt(e[0])),Xt=(e,t)=>e>t?e:t,Jt=(e,t)=>e<t?e:t,Qt=(e,t)=>{if(4===(n=e).length&&(Ut(n)||qt(n))){const n=Ut(e);return t&&n||!t&&!n?e:t&&!n?e.map((e=>e/255)):e.map((e=>255*e))}var n,o;if(3===(o=e).length&&(Ut(o)||qt(o))){const n=255**!t,o=Ut(e);return t&&o||!t&&!o?[...e,n]:t&&!o?[...e.map((e=>e/255)),n]:[...e.map((e=>255*e)),n]}return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)?((e,t=!1)=>[...Ft(e,t),255**!t])(e,t):(console.warn("Only HEX, RGB, and RGBA are handled by this function. Returning white instead."),t?[1,1,1,1]:[255,255,255,255])},en=e=>Object.entries(e).reduce(((e,[t,n])=>(e[n]?e[n]=[...e[n],t]:e[n]=t,e)),{}),tn=e=>.21*e[0]+.72*e[1]+.07*e[2],nn=e=>new Promise(((t,n)=>{if(!e||Array.isArray(e))t(e);else{const o=Array.isArray(e.x)||ArrayBuffer.isView(e.x)?e.x.length:0,r=(Array.isArray(e.x)||ArrayBuffer.isView(e.x))&&(t=>e.x[t]),i=(Array.isArray(e.y)||ArrayBuffer.isView(e.y))&&(t=>e.y[t]),a=(Array.isArray(e.line)||ArrayBuffer.isView(e.line))&&(t=>e.line[t]),s=(Array.isArray(e.lineOrder)||ArrayBuffer.isView(e.lineOrder))&&(t=>e.lineOrder[t]),l=Object.keys(e),c=(()=>{const t=l.find((e=>st.has(e)));return t&&(Array.isArray(e[t])||ArrayBuffer.isView(e[t]))&&(n=>e[t][n])})(),d=(()=>{const t=l.find((e=>lt.has(e)));return t&&(Array.isArray(e[t])||ArrayBuffer.isView(e[t]))&&(n=>e[t][n])})();r&&i&&c&&d&&a&&s?t(e.x.map(((e,t)=>[e,i(t),c(t),d(t),a(t),s(t)]))):r&&i&&c&&d&&a?t(Array.from({length:o},((e,t)=>[r(t),i(t),c(t),d(t),a(t)]))):r&&i&&c&&d?t(Array.from({length:o},((e,t)=>[r(t),i(t),c(t),d(t)]))):r&&i&&c?t(Array.from({length:o},((e,t)=>[r(t),i(t),c(t)]))):r&&i?t(Array.from({length:o},((e,t)=>[r(t),i(t)]))):n(new Error("You need to specify at least x and y"))}})),on=e=>Number.isFinite(e.y)&&!("x"in e),rn=e=>Number.isFinite(e.x)&&!("y"in e),an=e=>Number.isFinite(e.x)&&Number.isFinite(e.y)&&Number.isFinite(e.width)&&Number.isFinite(e.height),sn=e=>Number.isFinite(e.x1)&&Number.isFinite(e.y1)&&Number.isFinite(e.x2)&&Number.isFinite(e.x2),ln=e=>"vertices"in e&&e.vertices.length>1,cn=(e={})=>{let{regl:t,canvas:n=document.createElement("canvas"),gamma:o=be}=e,r=!1;t||(t=$t(n));const i=zt(t),a=[n.width,n.height],s=t.framebuffer({width:a[0],height:a[1],colorFormat:"rgba",colorType:"float"}),l=t({vert:"\n      precision highp float;\n      attribute vec2 xy;\n      void main () {\n        gl_Position = vec4(xy, 0, 1);\n      }",frag:"\n      precision highp float;\n      uniform vec2 srcRes;\n      uniform sampler2D src;\n      uniform float gamma;\n\n      vec3 approxLinearToSRGB (vec3 rgb, float gamma) {\n        return pow(clamp(rgb, vec3(0), vec3(1)), vec3(1.0 / gamma));\n      }\n\n      void main () {\n        vec4 color = texture2D(src, gl_FragCoord.xy / srcRes);\n        gl_FragColor = vec4(approxLinearToSRGB(color.rgb, gamma), color.a);\n      }",attributes:{xy:[-4,-4,4,-4,0,4]},uniforms:{src:()=>s,srcRes:()=>a,gamma:()=>o},count:3,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}}}),c=new Set,d=t.frame((()=>{const e=c.values();let t=e.next();for(;!t.done;)t.value(),t=e.next()})),u=()=>{const e=Math.min(window.innerWidth,window.screen.availWidth),t=Math.min(window.innerHeight,window.screen.availHeight);n.width=e*window.devicePixelRatio,n.height=t*window.devicePixelRatio,a[0]=n.width,a[1]=n.height,s.resize(...a)};e.canvas||(window.addEventListener("resize",u),window.addEventListener("orientationchange",u),u());return{get canvas(){return n},get regl(){return t},get gamma(){return o},set gamma(e){o=+e},get isSupported(){return i},get isDestroyed(){return r},render:(e,o)=>{t.clear(N),s.use((()=>{t.clear(N),e()})),l(),(e=>{const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.drawImage(n,(n.width-e.width)/2,(n.height-e.height)/2,e.width,e.height,0,0,e.width,e.height)})(o)},onFrame:e=>(c.add(e),()=>{c.delete(e)}),refresh:()=>{t.poll()},destroy:()=>{r=!0,window.removeEventListener("resize",u),window.removeEventListener("orientationchange",u),d.cancel(),n=void 0,t.destroy(),t=void 0}}},dn=e=>`\nprecision highp float;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform sampler2D stateTex;\nuniform float stateTexRes;\nuniform float stateTexEps;\nuniform float devicePixelRatio;\nuniform sampler2D encodingTex;\nuniform float encodingTexRes;\nuniform float encodingTexEps;\nuniform float pointSizeExtra;\nuniform float pointOpacityMax;\nuniform float pointOpacityScale;\nuniform float numPoints;\nuniform float globalState;\nuniform float isColoredByZ;\nuniform float isColoredByW;\nuniform float isOpacityByZ;\nuniform float isOpacityByW;\nuniform float isOpacityByDensity;\nuniform float isSizedByZ;\nuniform float isSizedByW;\nuniform float colorMultiplicator;\nuniform float opacityMultiplicator;\nuniform float opacityDensity;\nuniform float sizeMultiplicator;\nuniform float numColorStates;\nuniform float pointScale;\nuniform mat4 modelViewProjection;\n\nattribute vec2 stateIndex;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nvoid main() {\n  vec4 state = texture2D(stateTex, stateIndex);\n\n  gl_Position = modelViewProjection * vec4(state.x, state.y, 0.0, 1.0);\n\n  // Determine color index\n  float colorIndexZ =  isColoredByZ * floor(state.z * colorMultiplicator);\n  float colorIndexW =  isColoredByW * floor(state.w * colorMultiplicator);\n\n  // Multiply by the number of color states per color\n  // I.e., normal, active, hover, background, etc.\n  float colorIndex = (colorIndexZ + colorIndexW) * numColorStates;\n\n  // Half a "pixel" or "texel" in texture coordinates\n  float colorLinearIndex = colorIndex + globalState;\n\n  // Need to add cEps here to avoid floating point issue that can lead to\n  // dramatic changes in which color is loaded as floor(3/2.9999) = 1 but\n  // floor(3/3.0001) = 0!\n  float colorRowIndex = floor((colorLinearIndex + colorTexEps) / colorTexRes);\n\n  vec2 colorTexIndex = vec2(\n    (colorLinearIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n\n  // Retrieve point size\n  float pointSizeIndexZ = isSizedByZ * floor(state.z * sizeMultiplicator);\n  float pointSizeIndexW = isSizedByW * floor(state.w * sizeMultiplicator);\n  float pointSizeIndex = pointSizeIndexZ + pointSizeIndexW;\n\n  float pointSizeRowIndex = floor((pointSizeIndex + encodingTexEps) / encodingTexRes);\n  vec2 pointSizeTexIndex = vec2(\n    (pointSizeIndex / encodingTexRes) - pointSizeRowIndex + encodingTexEps,\n    pointSizeRowIndex / encodingTexRes + encodingTexEps\n  );\n  float pointSize = texture2D(encodingTex, pointSizeTexIndex).x;\n\n  // Retrieve opacity\n  ${3===e?"":`\n        if (isOpacityByDensity < 0.5) {\n          float opacityIndexZ = isOpacityByZ * floor(state.z * opacityMultiplicator);\n          float opacityIndexW = isOpacityByW * floor(state.w * opacityMultiplicator);\n          float opacityIndex = opacityIndexZ + opacityIndexW;\n\n          float opacityRowIndex = floor((opacityIndex + encodingTexEps) / encodingTexRes);\n          vec2 opacityTexIndex = vec2(\n            (opacityIndex / encodingTexRes) - opacityRowIndex + encodingTexEps,\n            opacityRowIndex / encodingTexRes + encodingTexEps\n          );\n          color.a = texture2D(encodingTex, opacityTexIndex)[${1+e}];\n        } else {\n          color.a = min(1.0, opacityDensity + globalState);\n        }\n      `}\n\n  color.a = min(pointOpacityMax, color.a) * pointOpacityScale;\n  finalPointSize = (pointSize * pointScale) + pointSizeExtra;\n  gl_PointSize = finalPointSize;\n}\n`,un=function(){const e=(e,t,n,o,r)=>{const i=.5*(o-t),a=.5*(r-n);return(2*n-2*o+i+a)*e*e*e+(-3*n+3*o-2*i-a)*e*e+i*e+n},t=(t,n,o)=>{const r=o*t,i=Math.floor(r),a=r-i,s=n[Math.max(0,i-1)],l=n[i],c=n[Math.min(o,i+1)],d=n[Math.min(o,i+2)];return[e(a,s[0],l[0],c[0],d[0]),e(a,s[1],l[1],c[1],d[1])]},n=(e,t,n)=>{let o=t[0],r=t[1],i=n[0]-o,a=n[1]-r;if(0!==i||0!==a){const t=((e[0]-o)*i+(e[1]-r)*a)/(i*i+a*a);t>1?(o=n[0],r=n[1]):t>0&&(o+=i*t,r+=a*t)}return i=e[0]-o,a=e[1]-r,i*i+a*a},o=(e,t,r,i,a)=>{let s,l=i;for(let o=t+1;o<r;o++){const i=n(e[o],e[t],e[r]);i>l&&(s=o,l=i)}l>i&&(s-t>1&&o(e,t,s,i,a),a.push(e[s]),r-s>1&&o(e,s,r,i,a))},r=(e,t)=>{const n=e.length-1,r=[e[0]];return o(e,0,n,t,r),r.push(e[n]),r};self.onmessage=function(e){(e.data.points?+e.data.points.length:0)||self.postMessage({error:new Error("No points provided")}),e.data.points;const n=(e=>{const t={},n=!Number.isNaN(+e[0][5]);return e.forEach((e=>{const o=e[4];t[o]||(t[o]=[]),n?t[o][e[5]]=e:t[o].push(e)})),Object.entries(t).forEach((e=>{t[e[0]]=e[1].filter((e=>e)),t[e[0]].reference=e[1][0]})),t})(e.data.points);self.postMessage({points:Object.entries(n).reduce(((n,o)=>(n[o[0]]=((e,{maxIntPointsPerSegment:n=100,tolerance:o=.002}={})=>{const i=e.length,a=i-1,s=a*n+1,l=o**2;let c,d=[];for(let o=0;o<i-1;o++){let i=[e[o].slice(0,2)];c=e[o];for(let r=1;r<n;r++){const d=t((o*n+r)/s,e,a);u=c[0],p=c[1],(u-d[0])**2+(p-d[1])**2>l&&(i.push(d),c=d)}i.push(e[o+1]),i=r(i,l),d=d.concat(i.slice(0,i.length-1))}var u,p;
/**
   * Douglas Peucker square segment distance
   * Implementation from https://github.com/mourner/simplify-js
   * @author Vladimir Agafonkin
   * @copyright Vladimir Agafonkin 2013
   * @license BSD
   * @param {array} p - Point
   * @param {array} p1 - First boundary point
   * @param {array} p2 - Second boundary point
   * @return {number} Distance
   */return d.push(e[e.length-1].slice(0,2)),d.flat()})(o[1],e.data.options),n[o[0]].reference=o[1].reference,n)),{})})}},pn=(e,t={tolerance:.002,maxIntPointsPerSegment:100})=>new Promise(((n,o)=>{const r=(i=un,new Worker(window.URL.createObjectURL(new Blob([`(${i.toString()})()`],{type:"text/javascript"}))));var i;r.onmessage=e=>{e.data.error?o(e.data.error):n(e.data.points),r.terminate()},r.postMessage({points:e,options:t})}));const mn={showRecticle:"showReticle",recticleColor:"reticleColor"},hn=e=>{const t=Object.keys(e).filter((e=>mn[e]));for(const n of t)console.warn(`regl-scatterplot: the "${n}" property is deprecated. Please use "${mn[n]}" instead.`),e[mn[n]]=e[n],delete e[n]},fn=(e,t,{allowSegment:n=!1,allowDensity:o=!1,allowInherit:r=!1}={})=>st.has(e)?"valueZ":lt.has(e)?"valueW":"segment"===e?n?"segment":t:"density"===e?o?"density":t:"inherit"===e&&r?"inherit":t,yn=e=>{switch(e){case"valueZ":return 2;case"valueW":return 3;default:return null}},gn=(t={})=>{const n=e({async:!t.syncEvents,caseInsensitive:!0}),i=new Float32Array(16),a=new Float32Array(16),s=[0,0];hn(t);let{renderer:c,backgroundColor:d=je,backgroundImage:u=Xe,canvas:f=document.createElement("canvas"),colorBy:v=Ne,deselectOnDblClick:w=et,deselectOnEscape:x=tt,lassoColor:E=X,lassoLineWidth:S=J,lassoMinDelay:A=ee,lassoMinDist:I=te,lassoClearEvent:P=ne,lassoInitiator:M=Q,lassoInitiatorParentElement:C=document.body,lassoOnLongPress:R=oe,lassoLongPressTime:L=re,lassoLongPressAfterEffectTime:D=ie,lassoLongPressEffectDelay:$=ae,lassoLongPressRevertEffectTime:N=se,keyMap:be=ve,mouseMode:st=W,showReticle:lt=Je,reticleColor:ut=Qe,pointColor:pt=Fe,pointColorActive:mt=ke,pointColorHover:ht=_e,showPointConnections:ft=nt,pointConnectionColor:yt=Ve,pointConnectionColorActive:gt=Ze,pointConnectionColorHover:vt=Ue,pointConnectionColorBy:wt=We,pointConnectionOpacity:xt=Te,pointConnectionOpacityBy:bt=Re,pointConnectionOpacityActive:Et=Le,pointConnectionSize:St=Pe,pointConnectionSizeActive:At=Me,pointConnectionSizeBy:It=Ce,pointConnectionMaxIntPointsPerSegment:Pt=ot,pointConnectionTolerance:Mt=rt,pointSize:Ct=Ee,pointSizeSelected:Tt=Se,pointSizeMouseDetection:Rt=it,pointOutlineWidth:Lt=Ae,opacity:Dt=O,opacityBy:Bt=De,opacityByDensityFill:zt=Be,opacityInactiveMax:$t=ze,opacityInactiveScale:Ft=$e,sizeBy:Zt=Ie,height:Ut=xe,width:Kt=we,annotationLineColor:qt=Ge,annotationLineWidth:un=Ye,annotationHVLineLimit:mn=Ke}=t,gn=Kt===O?1:Kt,vn=Ut===O?1:Ut;const{performanceMode:wn=at,opacityByDensityDebounceTime:xn=Oe,spatialIndexUseWorker:bn=ct}=t;st=Wt(j,F)(st),c||(c=cn({regl:t.regl,gamma:t.gamma})),d=Qt(d,!0),E=Qt(E,!0),ut=Qt(ut,!0);let En,Sn,An,In=!1,Pn=tn(d),Mn=!1,Cn=null,Tn=[0,0],Rn=-1,Ln=[];const Dn=new Set,Bn=new Set;let On=!1;const zn=new Set;let $n,Nn,Fn,kn,_n,jn,Wn,Vn,Zn,Un,Gn,Yn,Kn,qn,Hn,Xn=[],Jn=0,Qn=0,eo=!1,to=[],no=t.aspectRatio||1,oo=en(be),ro=!1,io=!0,ao=!1;pt=Ht(pt)?[...pt]:[pt],mt=Ht(mt)?[...mt]:[mt],ht=Ht(ht)?[...ht]:[ht],pt=pt.map((e=>Qt(e,!0))),mt=mt.map((e=>Qt(e,!0))),ht=ht.map((e=>Qt(e,!0))),Dt=!Array.isArray(Dt)&&Number.isNaN(+Dt)?pt[0][3]:Dt,Dt=kt(Dt,_t,{minLength:1})?[...Dt]:[Dt],Ct=kt(Ct,_t,{minLength:1})?[...Ct]:[Ct];let so,lo,co,uo,po=1/Ct[0];"inherit"===yt?yt=[...pt]:(yt=Ht(yt)?[...yt]:[yt],yt=yt.map((e=>Qt(e,!0)))),"inherit"===gt?gt=[...mt]:(gt=Ht(gt)?[...gt]:[gt],gt=gt.map((e=>Qt(e,!0)))),"inherit"===vt?vt=[...ht]:(vt=Ht(vt)?[...vt]:[vt],vt=vt.map((e=>Qt(e,!0)))),xt="inherit"===xt?[...Dt]:kt(xt,_t,{minLength:1})?[...xt]:[xt],St="inherit"===St?[...Ct]:kt(St,_t,{minLength:1})?[...St]:[St],v=fn(v,Ne),Bt=fn(Bt,De,{allowDensity:!0}),Zt=fn(Zt,Ie),wt=fn(wt,We,{allowSegment:!0,allowInherit:!0}),bt=fn(bt,Re,{allowSegment:!0}),It=fn(It,Ce,{allowSegment:!0});let mo,ho,fo,yo,go,vo,wo,xo,bo,Eo,So,Ao,Io=0,Po=0,Mo=!1,Co=null,To=lt,Ro=0,Lo=0,Do=!1,Bo=!1,Oo=!1,zo=!1,$o=G,No=G,Fo=!1,ko=t.xScale||null,_o=t.yScale||null,jo=0,Wo=0,Vo=0,Zo=0;ko&&(jo=ko.domain()[0],Wo=ko.domain()[1]-ko.domain()[0],ko.range([0,gn])),_o&&(Vo=_o.domain()[0],Zo=_o.domain()[1]-_o.domain()[0],_o.range([vn,0]));const Uo=e=>e/gn*2-1,Go=e=>1+e/vn*-2,Yo=(e,t)=>{const n=[e,t,1,1];return g(n,n,m(i,h(i,Fn,h(i,En.view,_n)))),n.slice(0,2)},Ko=(e=0)=>{const t=Yr(),n=(Kn[1]-qn[1])/f.height;return(Gn*t+e)*n},qo=()=>On?Xn.filter(((e,t)=>zn.has(t))):Xn,Ho=(e,t,n,o)=>{const r=$n.range(e,t,n,o);return On?r.filter((e=>zn.has(e))):r},Xo=()=>{const[e,t]=[Uo(s[0]),Go(s[1])],[n,o]=Yo(e,t),r=Ko(4),i=Ho(n-r,o-r,n+r,o+r);let a=r,l=-1;for(const e of i){const[t,r]=Xn[e],i=Nt(t,r,n,o);i<a&&(a=i,l=e)}return l},Jo=e=>{const t=(e=>{let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(let i=0;i<e.length;i+=2)t=e[i]<t?e[i]:t,n=e[i]>n?e[i]:n,o=e[i+1]<o?e[i+1]:o,r=e[i+1]>r?e[i+1]:r;return[t,o,n,r]})(e);if(!(([e,t,n,o])=>Number.isFinite(e)&&Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(o)&&n-e>0&&o-t>0)(t))return[];const n=Ho(...t),o=[];for(const t of n)Gt(e,Xn[t])&&o.push(t);return o},Qo=()=>{to=[],Sn&&Sn.clear()},er=e=>e&&e.length>4,tr=(e,t)=>{if(Vn||!ft||!er(Xn[e[0]]))return;const n=0===t,r=1===t?e=>Bn.add(e):o,i=Object.keys(e.reduce(((e,t)=>{const n=Xn[t];return e[Array.isArray(n[4])?n[4][0]:n[4]]=!0,e}),{})),a=jn.getData().opacities,s=i.filter((e=>!Bn.has(+e)));for(const e of s){const t=Wn[e][0],o=Wn[e][2],i=4*t+2*Wn[e][3],s=i+2*o+4;void 0===a.__original__&&(a.__original__=a.slice());for(let e=i;e<s;e++)a[e]=n?a.__original__[e]:Et;r(e)}jn.getBuffer().opacities.subdata(a,0)},nr=e=>[e%Io/Io+Po,Math.floor(e/Io)/Io+Po],or=e=>On&&!zn.has(e),rr=({preventEvent:e=!1}={})=>{P===K&&Qo(),Ln.length&&(e||n.publish("deselect"),Bn.clear(),tr(Ln,0),Ln=[],Dn.clear(),io=!0)},ir=(e,{merge:t=!1,preventEvent:o=!1}={})=>{const r=Array.isArray(e)?e:[e],i=[...Ln];if(t){if(Ln=((e,t)=>{const n=[];return e.forEach((e=>{n[e]=!0})),t.forEach((e=>{n[e]=!0})),n.reduce(((e,t,n)=>(t&&e.push(n),e)),[])})(Ln,r),i.length===Ln.length)return void(io=!0)}else{if(Ln?.length&&tr(Ln,0),i.length>0&&0===r.length)return void rr({preventEvent:o});Ln=r}if(((e,t)=>{if(e===t)return!0;if(e.length!==t.length)return!1;const n=new Set(e),o=new Set(t);return n.size===o.size&&t.every((e=>n.has(e)))})(i,Ln))return void(io=!0);const a=[];Dn.clear(),Bn.clear();for(let e=Ln.length-1;e>=0;e--){const t=Ln[e];t<0||t>=Jn||or(t)?Ln.splice(e,1):(Dn.add(t),a.push.apply(a,nr(t)))}ho({usage:"dynamic",type:"float",data:a}),tr(Ln,1),o||n.publish("select",{points:Ln}),io=!0},ar=(e,{showReticleOnce:t=!1,preventEvent:o=!1}={})=>{let r=!1;if(!(On&&!zn.has(e))&&e>=0&&e<Jn){r=!0;const t=Ao,i=e!==Ao;+t>=0&&i&&!Dn.has(t)&&tr([t],0),Ao=e,fo.subdata(nr(e)),Dn.has(e)||tr([e],2),i&&!o&&n.publish("pointover",Ao)}else r=+Ao>=0,r&&(Dn.has(Ao)||tr([Ao],0),o||n.publish("pointout",Ao)),Ao=void 0;r&&(io=!0,ao=t)},sr=e=>{const t=f.getBoundingClientRect();return s[0]=e.clientX-t.left,s[1]=e.clientY-t.top,[...s]},lr=Ot(f,{onStart:()=>{En.config({isFixed:!0}),Mn=!0,eo=!0,Qo(),Rn>=0&&(clearTimeout(Rn),Rn=-1),n.publish("lassoStart")},onDraw:(e,t)=>{to=e,Sn.setPoints(t),n.publish("lassoExtend",{coordinates:e})},onEnd:(e,t,{merge:o=!1}={})=>{En.config({isFixed:!1}),to=[...e];const r=Jo(t);ir(r,{merge:o}),n.publish("lassoEnd",{coordinates:to}),P===q&&Qo()},enableInitiator:M,initiatorParentElement:C,pointNorm:([e,t])=>Yo(Uo(e),Go(t))}),cr=(e,t)=>{switch(oo[t]){case pe:return e.altKey;case me:return e.metaKey;case he:return e.ctrlKey;case fe:return e.metaKey;case ye:return e.shiftKey;default:return!1}},dr=e=>{Bo&&1===e.buttons&&(Mn=!0,Cn=performance.now(),Tn=sr(e),eo=st===k||cr(e,le),!eo&&R&&(lr.showLongPressIndicator(e.clientX,e.clientY,{time:L,extraTime:D,delay:$}),Rn=setTimeout((()=>{Rn=-1,eo=!0}),L)))},ur=e=>{Bo&&(Mn=!1,Rn>=0&&(clearTimeout(Rn),Rn=-1),eo&&(e.preventDefault(),eo=!1,lr.end({merge:cr(e,de)})),R&&lr.hideLongPressIndicator({time:N}))},pr=e=>{if(!Bo)return;e.preventDefault();const t=sr(e);if(Nt(...t,...Tn)>=I)return;const n=performance.now()-Cn;if(!M||n<500){const t=Xo();t>=0?(Ln.length&&P===K&&Qo(),ir([t],{merge:cr(e,de)})):Yn||(Yn=setTimeout((()=>{Yn=null,lr.showInitiator(e)}),200))}},mr=e=>{lr.hideInitiator(),Yn&&(clearTimeout(Yn),Yn=null),w&&(e.preventDefault(),rr())},hr=e=>{if(zo||(Fo=(e=>document.elementsFromPoint(e.clientX,e.clientY).some((e=>e===f)))(e),zo=!0),!Bo||!Fo&&!Mn)return;const t=sr(e),n=Nt(...t,...Tn)>=I;Fo&&!eo&&ar(Xo()),eo?(e.preventDefault(),lr.extend(e,!0)):Mn&&R&&n&&lr.hideLongPressIndicator({time:N}),Rn>=0&&n&&(clearTimeout(Rn),Rn=-1),Mn&&(io=!0)},fr=()=>{Ao=void 0,Fo=!1,zo=!1,Bo&&(+Ao>=0&&!Dn.has(Ao)&&tr([Ao],0),ur(),io=!0)},yr=()=>{const e=Math.max(Ct.length,Dt.length);Lo=Math.max(2,Math.ceil(Math.sqrt(e)));const t=new Float32Array(Lo**2*4);for(let n=0;n<e;n++){t[4*n]=Ct[n]||0,t[4*n+1]=Math.min(1,Dt[n]||0);const e=Number((mt[n]||mt[0])[3]);t[4*n+2]=Math.min(1,Number.isNaN(e)?1:e);const o=Number((ht[n]||ht[0])[3]);t[4*n+3]=Math.min(1,Number.isNaN(o)?1:o)}return c.regl.texture({data:t,shape:[Lo,Lo,4],type:"float"})},gr=(e=pt,t=mt,n=ht)=>{const o=e.length,r=t.length,i=n.length,a=[];if(o===r&&r===i)for(let r=0;r<o;r++)a.push(e[r],t[r],n[r],d);else for(let r=0;r<o;r++){const o=[e[r][0],e[r][1],e[r][2],1],i=v===Ne?t[0]:o,s=v===Ne?n[0]:o;a.push(e[r],i,s,d)}return a},vr=()=>{const e=gr(),t=e.length;Ro=Math.max(2,Math.ceil(Math.sqrt(t)));const n=new Float32Array(Ro**2*4);return e.forEach(((e,t)=>{n[4*t]=e[0],n[4*t+1]=e[1],n[4*t+2]=e[2],n[4*t+3]=e[3]})),c.regl.texture({data:n,shape:[Ro,Ro,4],type:"float"})},wr=()=>{Nn=gn/vn,Fn=y([],[1/Nn,1,1]),kn=y([],[1/Nn,1,1]),_n=y([],[no,1,1])},xr=(e,t)=>n=>{if(!n?.length)return;const o=[...e()];let r=Ht(n)?n:[n];r=r.map((e=>Qt(e,!0))),Eo&&Eo.destroy();try{t(r),Eo=vr()}catch(e){console.error("Invalid colors. Switching back to default colors."),t(o),Eo=vr()}},br=xr((()=>pt),(e=>{pt=e})),Er=xr((()=>mt),(e=>{mt=e})),Sr=xr((()=>ht),(e=>{ht=e})),Ar=()=>{if(!ko&&!_o)return;const[e,t]=(()=>{const e=Yo(-1,-1),t=Yo(1,1),n=(e[0]+1)/2,o=(t[0]+1)/2,r=(e[1]+1)/2,i=(t[1]+1)/2;return[[jo+n*Wo,jo+o*Wo],[Vo+r*Zo,Vo+i*Zo]]})();ko&&ko.domain(e),_o&&_o.domain(t)},Ir=e=>{vn=Math.max(1,e),f.height=Math.floor(vn*window.devicePixelRatio),_o&&(_o.range([vn,0]),Ar())},Pr=()=>{Gn=Rt,Rt===O&&(Gn=Array.isArray(Ct)?Ct.reduce(((e,t)=>t>e?t:e),-1/0):Ct)},Mr=e=>{gn=Math.max(1,e),f.width=Math.floor(gn*window.devicePixelRatio),ko&&(ko.range([0,gn]),Ar())},Cr=e=>{switch(e){case"valueZ":return $o;case"valueW":return No;default:return null}},Tr=(e,t)=>e===U?e=>Math.round(e*(t.length-1)):o,Rr=()=>[f.width,f.height],Lr=()=>Eo,Dr=()=>Ro,Br=()=>.5/Ro,Or=()=>window.devicePixelRatio,zr=()=>ho,$r=()=>So,Nr=()=>Lo,Fr=()=>.5/Lo,kr=()=>0,_r=()=>co||so,jr=()=>Io,Wr=()=>.5/Io,Vr=()=>kn,Zr=()=>En.view,Ur=()=>_n,Gr=()=>h(a,kn,h(a,En.view,_n)),Yr=()=>En.scaling[0]>1?Math.asinh(Xt(1,En.scaling[0]))/Math.asinh(1)*window.devicePixelRatio:Xt(po,En.scaling[0])*window.devicePixelRatio,Kr=()=>Ln.length,qr=()=>Kr()>0?$t:1,Hr=()=>Kr()>0?Ft:1,Xr=()=>+("valueZ"===v),Jr=()=>+("valueW"===v),Qr=()=>+("valueZ"===Bt),ei=()=>+("valueW"===Bt),ti=()=>+("density"===Bt),ni=()=>+("valueZ"===Zt),oi=()=>+("valueW"===Zt),ri=()=>"valueZ"===v?$o===U?pt.length-1:1:No===U?pt.length-1:1,ii=()=>"valueZ"===Bt?$o===U?Dt.length-1:1:No===U?Dt.length-1:1,ai=()=>"valueZ"===Zt?$o===U?Ct.length-1:1:No===U?Ct.length-1:1,si=e=>{if("density"!==Bt)return 1;const t=Yr(),n=Ct[0]*t,o=2/(2/En.view[0])*(2/(2/En.view[5])),r=e.viewportHeight,i=e.viewportWidth;let a=zt*i*r/(Qn*n*n)*Jt(1,o);a*=wn?1:1/(.25*Math.PI);return a*=(n/(Xt(1,n)+.5))**2,Jt(1,Xt(0,a))},li=c.regl({framebuffer:()=>uo,vert:"precision highp float;\n\nattribute vec2 position;\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // map normalized device coords to texture coords\n  particleTextureIndex = 0.5 * (1.0 + position);\n\n  gl_Position = vec4(position, 0, 1);\n}",frag:"precision highp float;\n\nuniform sampler2D startStateTex;\nuniform sampler2D endStateTex;\nuniform float t;\n\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // Interpolate x, y, and value\n  vec3 start = texture2D(startStateTex, particleTextureIndex).xyw;\n  vec3 end = texture2D(endStateTex, particleTextureIndex).xyw;\n  vec3 curr = start * (1.0 - t) + end * t;\n\n  // The category cannot be interpolated\n  float endCategory = texture2D(endStateTex, particleTextureIndex).z;\n\n  gl_FragColor = vec4(curr.xy, endCategory, curr.z);\n}",attributes:{position:[-4,0,4,4,4,-4]},uniforms:{startStateTex:()=>lo,endStateTex:()=>so,t:(e,t)=>t.t},count:3}),ci=(e,t,n,o=0,r=qr,i=Hr)=>c.regl({frag:wn?"precision highp float;\n\nvarying vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n":"\nprecision highp float;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nfloat linearstep(float edge0, float edge1, float x) {\n  return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\nvoid main() {\n  vec2 c = gl_PointCoord * 2.0 - 1.0;\n  float sdf = length(c) * finalPointSize;\n  float alpha = linearstep(finalPointSize + 0.5, finalPointSize - 0.5, sdf);\n\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n",vert:dn(o),blend:{enable:!wn,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},depth:{enable:!1},attributes:{stateIndex:{buffer:n,size:2}},uniforms:{resolution:Rr,modelViewProjection:Gr,devicePixelRatio:Or,pointScale:Yr,encodingTex:$r,encodingTexRes:Nr,encodingTexEps:Fr,pointOpacityMax:r,pointOpacityScale:i,pointSizeExtra:e,globalState:o,colorTex:Lr,colorTexRes:Dr,colorTexEps:Br,stateTex:_r,stateTexRes:jr,stateTexEps:Wr,isColoredByZ:Xr,isColoredByW:Jr,isOpacityByZ:Qr,isOpacityByW:ei,isOpacityByDensity:ti,isSizedByZ:ni,isSizedByW:oi,colorMultiplicator:ri,opacityMultiplicator:ii,opacityDensity:si,sizeMultiplicator:ai,numColorStates:4},count:t,primitive:"points"}),di=ci(kr,(()=>On?zn.size:Jn),(()=>mo)),ui=ci(kr,(()=>1),(()=>fo),2,(()=>1),(()=>1)),pi=ci((()=>(Tt+2*Lt)*window.devicePixelRatio),Kr,zr,1,(()=>1),(()=>1)),mi=ci((()=>(Tt+Lt)*window.devicePixelRatio),Kr,zr,3,(()=>1),(()=>1)),hi=ci((()=>Tt*window.devicePixelRatio),Kr,zr,1,(()=>1),(()=>1)),fi=c.regl({frag:"\nprecision mediump float;\n\nuniform sampler2D texture;\n\nvarying vec2 uv;\n\nvoid main () {\n  gl_FragColor = texture2D(texture, uv);\n}\n",vert:"\nprecision mediump float;\n\nuniform mat4 modelViewProjection;\n\nattribute vec2 position;\n\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = modelViewProjection * vec4(-1.0 + 2.0 * uv.x, 1.0 - 2.0 * uv.y, 0, 1);\n}\n",attributes:{position:[0,1,0,0,1,0,0,1,1,1,1,0]},uniforms:{modelViewProjection:Gr,texture:()=>u},count:6}),yi=c.regl({vert:"\n      precision mediump float;\n      uniform mat4 modelViewProjection;\n      attribute vec2 position;\n      void main () {\n        gl_Position = modelViewProjection * vec4(position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform vec4 color;\n      void main () {\n        gl_FragColor = vec4(color.rgb, 0.2);\n      }",depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},attributes:{position:()=>to},uniforms:{modelViewProjection:Gr,color:()=>E},elements:()=>Array.from({length:to.length-2},((e,t)=>[0,t+1,t+2]))}),gi=e=>{const t=new Float32Array(2*e);let n=0;for(let o=0;o<e;++o){const e=nr(o);t[n]=e[0],t[n+1]=e[1],n+=2}return t},vi=(e,t={})=>{const n=e.length;Io=Math.max(2,Math.ceil(Math.sqrt(n))),Po=.5/Io;const o=new Float32Array(Io**2*4);let r=!0,i=!0,a=0,s=0,l=0;for(let t=0;t<n;++t)a=4*t,o[a]=e[t][0],o[a+1]=e[t][1],s=e[t][2]||0,l=e[t][3]||0,o[a+2]=s,o[a+3]=l,r&&=Number.isInteger(s),i&&=Number.isInteger(l);return $o=t.z&&Y.includes(t.z)?t.z:r?G:U,No=t.w&&Y.includes(t.w)?t.w:i?G:U,c.regl.texture({data:o,shape:[Io,Io,4],type:"float"})},wi=(e,t={})=>new Promise((n=>{Bo=!1;const o=t?.preventFilterReset&&e.length===Jn;Jn=e.length,Qn=Jn,so&&so.destroy(),so=vi(e,{z:t.zDataType,w:t.wDataType}),o||mo({usage:"static",type:"float",data:gi(Jn)}),B(t.spatialIndex||e,{useWorker:bn}).then((t=>{$n=t,Xn=e,Bo=!0})).then(n)})),xi=(e,t)=>{yo=En.target,go=e,vo=En.distance[0],wo=t},bi=e=>{const t="inherit"===wt?v:wt;if("segment"===t){const t=yt.length-1;return t<1?[]:e.reduce(((e,n,o)=>{let r=0;const i=[];for(let e=2;e<n.length;e+=2){const t=Math.sqrt((n[e-2]-n[e])**2+(n[e-1]-n[e+1])**2);i.push(t),r+=t}e[o]=[0];let a=0;for(let s=0;s<n.length/2-1;s++)a+=i[s],e[o].push(4*Math.floor(a/r*t));return e}),[])}if(t){const e=yn(t),n=Tr(Cr(t),"inherit"===wt?pt:yt);return Wn.reduce(((t,[o,r])=>(t[o]=4*n(r[e]),t)),[])}return Array(Wn.length).fill(0)},Ei=()=>{const e="inherit"===bt?Bt:bt;if("segment"===e){const e=xt.length-1;return e<1?[]:Wn.reduce(((t,[n,o,i])=>(t[n]=r(i,(t=>xt[Math.floor(t/(i-1)*e)])),t)),[])}if(e){const t=yn(e),n="inherit"===bt?Dt:xt,o=Tr(Cr(e),n);return Wn.reduce(((e,[r,i])=>(e[r]=n[o(i[t])],e)),[])}},Si=()=>{const e="inherit"===It?Zt:It;if("segment"===e){const e=St.length-1;return e<1?[]:Wn.reduce(((t,[n,o,i])=>(t[n]=r(i,(t=>St[Math.floor(t/(i-1)*e)])),t)),[])}if(e){const t=yn(e),n="inherit"===It?Ct:St,o=Tr(Cr(e),n);return Wn.reduce(((e,[r,i])=>(e[r]=n[o(i[t])],e)),[])}},Ai=e=>new Promise((t=>{jn.setPoints([]),e?.length?(Vn=!0,pn(e,{maxIntPointsPerSegment:Pt,tolerance:Mt}).then((e=>{(e=>{Wn=[];let t=0;Object.keys(e).forEach(((n,o)=>{Wn[n]=[o,e[n].reference,e[n].length/2,t],t+=e[n].length/2}))})(e);const n=Object.values(e);jn.setPoints(1===n.length?n[0]:n,{colorIndices:bi(n),opacities:Ei(),widths:Si()}),Vn=!1,t()}))):t()})),Ii=(e,{preventEvent:t=!1}={})=>{const o=Array.isArray(e)?e:[e];On=!0,zn.clear();const r=[],i=[];for(let e=o.length-1;e>=0;e--){const t=o[e];t<0||t>=Jn?o.splice(e,1):(zn.add(t),r.push.apply(r,nr(t)),Dn.has(t)&&i.push(t))}return mo.subdata(r),ir(i,{preventEvent:t}),zn.has(Ao)||ar(-1,{preventEvent:t}),new Promise((e=>{const r=()=>{n.subscribe("draw",(()=>{t||n.publish("filter",{points:o}),e()}),1),io=!0};ft||er(Xn[0])?Ai(qo()).then((()=>{t||n.publish("pointConnectionsDraw"),ir(i,{preventEvent:t}),r()})):r()}))},Pi=()=>Ho(qn[0],qn[1],Kn[0],Kn[1]),Mi=l((()=>{Qn=Pi().length}),xn),Ci=()=>Boolean(lo&&co),Ti=()=>Boolean(void 0!==yo&&void 0!==go&&void 0!==vo&&void 0!==wo),Ri=(e,t)=>{Co||(Co=performance.now());const n=performance.now()-Co,o=(r=t(n/e),i=0,a=1,Math.min(a,Math.max(i,r)));var r,i,a;return Ci()&&li({t:o}),Ti()&&(e=>{const[t,n]=yo,[o,r]=go,i=1-e,a=t*i+o*e,s=n*i+r*e,l=vo*i+wo*e;En.lookAt([a,s],l)})(o),n<e},Li=()=>{Mo=!1,Co=null,xo=void 0,bo=void 0,lt=To,lo&&(lo.destroy(),lo=void 0),co&&(co.destroy(),co=void 0),yo=void 0,go=void 0,vo=void 0,wo=void 0,n.publish("transitionEnd")},Di=({duration:e=500,easing:t=Z})=>{Mo&&n.publish("transitionEnd"),Mo=!0,Co=null,xo=e,bo=Yt(t)?V[t]||Z:t,To=lt,lt=!1,n.publish("transitionStart")},Bi=e=>In?Promise.reject(new Error("The instance was already destroyed")):(Oo=!1,0===e.length?new Promise((e=>{An.clear(),n.subscribe("draw",e,1),Oo=!0,io=!0})):new Promise((t=>{const r=[],i=new Map,a=[],s=[];let l=-1;const c=e=>{s.push(e.lineWidth||un);const t=Qt(e.lineColor||qt,!0),n=`[${t.join(",")}]`;if(i.has(n)){const{idx:e}=i.get(n);a.push(e)}else{const e=++l;i.set(n,{idx:e,color:t}),a.push(e)}};for(const t of e)on(t)?(r.push([t.x1??-mn,t.y,t.x2??mn,t.y]),c(t)):rn(t)?(r.push([t.x,t.y1??-mn,t.x,t.y2??mn]),c(t)):sn(t)?(r.push([t.x1,t.y1,t.x2,t.y1,t.x2,t.y2,t.x1,t.y2,t.x1,t.y1]),c(t)):an(t)?(r.push([t.x,t.y,t.x+t.width,t.y,t.x+t.width,t.y+t.height,t.x,t.y+t.height,t.x,t.y]),c(t)):ln(t)&&(r.push(t.vertices.flatMap(o)),c(t));An.setStyle({color:Array.from(i.values()).sort(((e,t)=>e.idx>t.idx?1:-1)).map((({color:e})=>e))}),An.setPoints(1===r.length?r.flat():r,{colorIndices:a,widths:s}),n.subscribe("draw",t,1),Oo=!0,io=!0}))),Oi=e=>(...t)=>{const o=e(...t);return io=!0,new Promise((e=>{n.subscribe("draw",(()=>e(o)),1)}))},zi=(e,t={})=>new Promise((o=>{const r=g([],[e.x+e.width/2,e.y+e.height/2,0,0],_n).slice(0,2),i=2*Math.atan(1),a=Nn/no,s=e.height*a>=e.width?e.height/2/Math.tan(i/2):e.width/2/Math.tan(i/2)/a;t.transition?(En.config({isFixed:!0}),xi(r,s),n.subscribe("transitionEnd",(()=>{o(),En.config({isFixed:!1})}),1),Di({duration:t.transitionDuration,easing:t.transitionEasing})):(En.lookAt(r,s),n.subscribe("draw",o,1),io=!0)})),$i=(e,t,o={})=>new Promise((r=>{o.transition?(En.config({isFixed:!0}),xi(e,t),n.subscribe("transitionEnd",(()=>{r(),En.config({isFixed:!1})}),1),Di({duration:o.transitionDuration,easing:o.transitionEasing})):(En.lookAt(e,t),n.subscribe("draw",r,1),io=!0)})),Ni=()=>{jn.setStyle({color:gr(yt,gt,vt),opacity:null===xt?null:xt[0],width:St[0]})},Fi=()=>{const e=Math.round(Pn)>.5?0:255;lr.initiator.style.border=`1px dashed rgba(${e}, ${e}, ${e}, 0.33)`,lr.initiator.style.background=`rgba(${e}, ${e}, ${e}, 0.1)`},ki=()=>{const e=Math.round(Pn)>.5?0:255;lr.longPressIndicator.style.color=`rgb(${e}, ${e}, ${e})`,lr.longPressIndicator.dataset.color=`rgb(${e}, ${e}, ${e})`;const t=E.map((e=>Math.round(255*e)));lr.longPressIndicator.dataset.activeColor=`rgb(${t[0]}, ${t[1]}, ${t[2]})`},_i=e=>{e&&En.setView(e)},ji=(e,t)=>n=>{if("inherit"===n)e([...t()]);else{const t=Ht(n)?n:[n];e(t.map((e=>Qt(e,!0))))}Ni()},Wi=ji((e=>{yt=e}),(()=>pt)),Vi=ji((e=>{gt=e}),(()=>mt)),Zi=ji((e=>{vt=e}),(()=>ht)),Ui=(e={})=>{var t,o,r,i,a,s,l,p,m,h,y,g,b,T,B,z,k,W,V,Z,U,G,Y,K,q,X,J,Q,ee,te,ne,oe,re,ie,ae,se,le,de,pe,me,he,fe;return hn(e),void 0===e.backgroundColor&&void 0===e.background||(t=e.backgroundColor||e.background)&&(d=Qt(t,!0),Pn=tn(d),Fi(),ki()),void 0!==e.backgroundImage&&((o=e.backgroundImage)?Yt(o)?Vt(c.regl,o).then((e=>{u=e,io=!0,n.publish("backgroundImageReady")})).catch((()=>{console.error(`Count not create texture from ${o}`),u=null})):u="texture2d"===o._reglType?o:null:u=null),void 0!==e.cameraTarget&&(r=e.cameraTarget)&&En.lookAt(r,En.distance[0],En.rotation),void 0!==e.cameraDistance&&(i=e.cameraDistance)>0&&En.lookAt(En.target,i,En.rotation),void 0!==e.cameraRotation&&null!==(a=e.cameraRotation)&&En.lookAt(En.target,En.distance[0],a),void 0!==e.cameraView&&_i(e.cameraView),void 0!==e.colorBy&&(s=e.colorBy,v=fn(s,Ne)),void 0!==e.pointColor&&br(e.pointColor),void 0!==e.pointColorActive&&Er(e.pointColorActive),void 0!==e.pointColorHover&&Sr(e.pointColorHover),void 0!==e.pointSize&&(l=e.pointSize,kt(l,_t,{minLength:1})&&(Ct=[...l]),jt(+l)&&(Ct=[+l]),po=1/Ct[0],So=yr(),Pr()),void 0!==e.pointSizeSelected&&(!+(p=e.pointSizeSelected)||+p<0||(Tt=+p)),void 0!==e.pointSizeMouseDetection&&(m=e.pointSizeMouseDetection,Rt=m,Pr()),void 0!==e.sizeBy&&(e=>{Zt=fn(e,Ie)})(e.sizeBy),void 0!==e.opacity&&(h=e.opacity,kt(h,_t,{minLength:1})&&(Dt=[...h]),jt(+h)&&(Dt=[+h]),So=yr()),void 0!==e.showPointConnections&&(y=e.showPointConnections,ft=!!y,ft?Bo&&er(Xn[0])&&Ai(qo()).then((()=>{n.publish("pointConnectionsDraw"),io=!0})):Ai()),void 0!==e.pointConnectionColor&&Wi(e.pointConnectionColor),void 0!==e.pointConnectionColorActive&&Vi(e.pointConnectionColorActive),void 0!==e.pointConnectionColorHover&&Zi(e.pointConnectionColorHover),void 0!==e.pointConnectionColorBy&&(e=>{wt=fn(e,We,{allowSegment:!0,allowInherit:!0})})(e.pointConnectionColorBy),void 0!==e.pointConnectionOpacityBy&&(e=>{bt=fn(e,Re,{allowSegment:!0})})(e.pointConnectionOpacityBy),void 0!==e.pointConnectionOpacity&&(e=>{kt(e,_t,{minLength:1})&&(xt=[...e]),jt(+e)&&(xt=[+e]),yt=yt.map((e=>(e[3]=Number.isNaN(+xt[0])?e[3]:+xt[0],e))),Ni()})(e.pointConnectionOpacity),void 0!==e.pointConnectionOpacityActive&&(e=>{!Number.isNaN(+e)&&+e&&(Et=+e)})(e.pointConnectionOpacityActive),void 0!==e.pointConnectionSize&&(g=e.pointConnectionSize,kt(g,_t,{minLength:1})&&(St=[...g]),jt(+g)&&(St=[+g]),Ni()),void 0!==e.pointConnectionSizeActive&&(b=e.pointConnectionSizeActive,!Number.isNaN(+b)&&+b&&(At=Math.max(0,b))),void 0!==e.pointConnectionSizeBy&&(e=>{It=fn(e,Ce,{allowSegment:!0})})(e.pointConnectionSizeBy),void 0!==e.pointConnectionMaxIntPointsPerSegment&&(T=e.pointConnectionMaxIntPointsPerSegment,Pt=Math.max(0,T)),void 0!==e.pointConnectionTolerance&&(B=e.pointConnectionTolerance,Mt=Math.max(0,B)),void 0!==e.opacityBy&&(e=>{Bt=fn(e,De,{allowDensity:!0})})(e.opacityBy),void 0!==e.lassoColor&&(e=>{if(!e)return;E=Qt(e,!0),Sn.setStyle({color:E});const t=E.map((e=>Math.round(255*e)));lr.longPressIndicator.dataset.activeColor=`rgb(${t[0]}, ${t[1]}, ${t[2]})`})(e.lassoColor),void 0!==e.lassoLineWidth&&(z=e.lassoLineWidth,Number.isNaN(+z)||+z<1||(S=+z,Sn.setStyle({width:S}))),void 0!==e.lassoMinDelay&&+(k=e.lassoMinDelay)&&(A=+k,lr.set({minDelay:A})),void 0!==e.lassoMinDist&&+(W=e.lassoMinDist)&&(I=+W,lr.set({minDist:I})),void 0!==e.lassoClearEvent&&(V=e.lassoClearEvent,P=Wt(H,P)(V)),void 0!==e.lassoInitiator&&(Z=e.lassoInitiator,M=Boolean(Z),lr.set({enableInitiator:M})),void 0!==e.lassoInitiatorParentElement&&(U=e.lassoInitiatorParentElement,C=U,lr.set({startInitiatorParentElement:C})),void 0!==e.lassoOnLongPress&&(G=e.lassoOnLongPress,R=Boolean(G)),void 0!==e.lassoLongPressTime&&(Y=e.lassoLongPressTime,L=Number(Y)),void 0!==e.lassoLongPressAfterEffectTime&&(K=e.lassoLongPressAfterEffectTime,D=Number(K)),void 0!==e.lassoLongPressEffectDelay&&(q=e.lassoLongPressEffectDelay,$=Number(q)),void 0!==e.lassoLongPressRevertEffectTime&&(e=>{N=Number(e)})(e.lassoLongPressRevertEffectTime),void 0!==e.keyMap&&(X=e.keyMap,be=Object.entries(X).reduce(((e,[t,n])=>(ge.includes(t)&&ue.includes(n)&&(e[t]=n),e)),{}),oo=en(be),oo[ce]?En.config({isRotate:!0,mouseDownMoveModKey:oo[ce]}):En.config({isRotate:!1})),void 0!==e.mouseMode&&(J=e.mouseMode,st=Wt(j,F)(J),En.config({defaultMouseDownMoveAction:st===_?"rotate":"pan"})),void 0!==e.showReticle&&null!==(Q=e.showReticle)&&(lt=Q),void 0!==e.reticleColor&&(ee=e.reticleColor)&&(ut=Qt(ee,!0),Zn.setStyle({color:ut}),Un.setStyle({color:ut})),void 0!==e.pointOutlineWidth&&(!+(te=e.pointOutlineWidth)||+te<0||(Lt=+te)),void 0!==e.height&&(e=>{if(e===O)return Ut=e,f.style.height="100%",void window.requestAnimationFrame((()=>{f&&Ir(f.getBoundingClientRect().height)}));!+e||+e<=0||(Ut=+e,Ir(Ut),f.style.height=`${Ut}px`)})(e.height),void 0!==e.width&&(e=>{if(e===O)return Kt=e,f.style.width="100%",void window.requestAnimationFrame((()=>{f&&Mr(f.getBoundingClientRect().width)}));!+e||+e<=0||(Kt=+e,Mr(Kt),f.style.width=`${gn}px`)})(e.width),void 0!==e.aspectRatio&&(+(ne=e.aspectRatio)<=0||(no=ne)),void 0!==e.xScale&&(oe=e.xScale)&&(ko=oe,jo=oe.domain()[0],Wo=oe?oe.domain()[1]-oe.domain()[0]:0,ko.range([0,gn]),Ar()),void 0!==e.yScale&&(re=e.yScale)&&(_o=re,Vo=_o.domain()[0],Zo=_o?_o.domain()[1]-_o.domain()[0]:0,_o.range([vn,0]),Ar()),void 0!==e.deselectOnDblClick&&(ie=e.deselectOnDblClick,w=!!ie),void 0!==e.deselectOnEscape&&(ae=e.deselectOnEscape,x=!!ae),void 0!==e.opacityByDensityFill&&(se=e.opacityByDensityFill,zt=+se),void 0!==e.opacityInactiveMax&&(le=e.opacityInactiveMax,$t=+le),void 0!==e.opacityInactiveScale&&(de=e.opacityInactiveScale,Ft=+de),void 0!==e.gamma&&(pe=e.gamma,c.gamma=pe),void 0!==e.annotationLineColor&&(me=e.annotationLineColor,qt=Qt(me)),void 0!==e.annotationLineWidth&&(he=e.annotationLineWidth,un=+he),void 0!==e.annotationHVLineLimit&&(fe=e.annotationHVLineLimit,mn=+fe),new Promise((e=>{window.requestAnimationFrame((()=>{f&&(wr(),En.refresh(),c.refresh(),io=!0,e())}))}))},Gi=()=>{En||(En=b(f,{isPanInverted:[!1,!0],defaultMouseDownMoveAction:st===_?"rotate":"pan"})),t.cameraView?En.setView(p(t.cameraView)):t.cameraTarget||t.cameraDistance||t.cameraRotation?En.lookAt([...t.cameraTarget||qe],t.cameraDistance||1,t.cameraRotation||0):En.setView(p(He)),Kn=Yo(1,1),qn=Yo(-1,-1)},Yi=({key:e})=>{if("Escape"===e)x&&rr()},Ki=()=>{Fo=!0,zo=!0},qi=()=>{ar(),Fo=!1,zo=!0,io=!0},Hi=()=>{io=!0},Xi=()=>{wi([]),jn.clear()},Ji=()=>{Bi([])},Qi=()=>{En.refresh();const e=Kt===O,t=Ut===O;if(e||t){const{width:n,height:o}=f.getBoundingClientRect();e&&Mr(n),t&&Ir(o),wr(),io=!0}},ea=c.onFrame((()=>{if(Do=En.tick(),!Bo&&!Oo||!io&&!Mo)return;Mo&&!Ri(xo,bo)&&Li(),Do&&(Kn=Yo(1,1),qn=Yo(-1,-1),"density"===Bt&&Mi()),c.render((()=>{((e,t)=>{kn[0]=e/Nn,kn[5]=t})(f.width/c.canvas.width,f.height/c.canvas.height),u?._reglType&&fi(),to.length>2&&yi(),Mo||jn.draw({projection:Vr(),model:Ur(),view:Zr()}),Bo&&di(),Mn||!lt&&!ao||(()=>{if(!(Ao>=0))return;const[e,t]=Xn[Ao].slice(0,2),n=[e,t,0,1];h(i,kn,h(i,En.view,_n)),g(n,n,i),Zn.setPoints([-1,n[1],1,n[1]]),Un.setPoints([n[0],1,n[0],-1]),Zn.draw(),Un.draw(),ci((()=>(Tt+2*Lt)*window.devicePixelRatio),(()=>1),fo,1)(),ci((()=>(Tt+Lt)*window.devicePixelRatio),(()=>1),fo,3)()})(),Ao>=0&&ui(),Ln.length&&(pi(),mi(),hi()),An.draw({projection:Vr(),model:Ur(),view:Zr()}),Sn.draw({projection:Vr(),model:Ur(),view:Zr()})}),f);const e={view:En.view,camera:En,xScale:ko,yScale:_o};Do&&(Ar(),ro?ro=!1:n.publish("view",e)),io=!1,ao=!1,n.publish("drawing",e,{async:!1}),n.publish("draw",e)}));return(()=>{wr(),Gi(),Ar(),Sn=T(c.regl,{color:E,width:S,is2d:!0}),jn=T(c.regl,{color:gr(yt,gt,vt),opacity:null===xt?null:xt[0],width:St[0],widthActive:At,is2d:!0}),Zn=T(c.regl,{color:ut,width:1,is2d:!0}),Un=T(c.regl,{color:ut,width:1,is2d:!0}),An=T(c.regl,{color:qt,width:un,is2d:!0}),Pr(),f.addEventListener("wheel",Hi),mo=c.regl.buffer(),ho=c.regl.buffer(),fo=c.regl.buffer({usage:"dynamic",type:"float",length:2*z}),Eo=vr(),So=yr();const e=Ui({backgroundImage:u,width:Kt,height:Ut,keyMap:be});Fi(),ki(),window.addEventListener("keyup",Yi,!1),window.addEventListener("blur",fr,!1),window.addEventListener("mouseup",ur,!1),window.addEventListener("mousemove",hr,!1),f.addEventListener("mousedown",dr,!1),f.addEventListener("mouseenter",Ki,!1),f.addEventListener("mouseleave",qi,!1),f.addEventListener("click",pr,!1),f.addEventListener("dblclick",mr,!1),"ResizeObserver"in window?(Hn=new ResizeObserver(Qi),Hn.observe(f)):(window.addEventListener("resize",Qi),window.addEventListener("orientationchange",Qi)),e.then((()=>{n.publish("init")}))})(),{get isSupported(){return c.isSupported},clear:Oi((()=>{Xi(),Ji()})),clearPoints:Oi(Xi),clearPointConnections:Oi((()=>{jn.clear()})),clearAnnotations:Oi(Ji),createTextureFromUrl:(e,t=15e3)=>Vt(c.regl,e,t),deselect:rr,destroy:()=>{Bo=!1,Oo=!1,In=!0,ea(),window.removeEventListener("keyup",Yi,!1),window.removeEventListener("blur",fr,!1),window.removeEventListener("mouseup",ur,!1),window.removeEventListener("mousemove",hr,!1),f.removeEventListener("mousedown",dr,!1),f.removeEventListener("mouseenter",Ki,!1),f.removeEventListener("mouseleave",qi,!1),f.removeEventListener("click",pr,!1),f.removeEventListener("dblclick",mr,!1),f.removeEventListener("wheel",Hi,!1),Hn?Hn.disconnect():(window.removeEventListener("resize",Qi),window.removeEventListener("orientationchange",Qi)),f=void 0,En.dispose(),En=void 0,Sn.destroy(),lr.destroy(),jn.destroy(),Zn.destroy(),Un.destroy(),t.renderer||c.isDestroyed||c.destroy(),n.publish("destroy"),n.clear()},draw:(e,t={})=>In?Promise.reject(new Error("The instance was already destroyed")):nn(e).then((e=>new Promise((o=>{if(In)return void o();let r=!1;t.preventFilterReset&&e?.length===Jn||(On=!1,zn.clear());const i=e&&er(e[0])&&(ft||t.showPointConnectionsOnce),{zDataType:a,wDataType:s}=t;new Promise((l=>{e?(t.transition&&(e.length===Jn?r=((e,t={})=>{if(!so)return!1;if(Mo){const e=lo;lo=co,e.destroy()}else lo=so;return co=vi(e,t),uo=c.regl.framebuffer({color:co,depth:!1,stencil:!1}),so=void 0,!0})(e,{z:a,w:s}):console.warn("Cannot transition! The number of points between the previous and current draw call must be identical.")),wi(e,{zDataType:a,wDataType:s,preventFilterReset:t.preventFilterReset,spatialIndex:t.spatialIndex}).then((()=>{void 0!==t.hover&&ar(t.hover,{preventEvent:!0}),void 0!==t.select&&ir(t.select,{preventEvent:!0}),void 0!==t.filter&&Ii(t.filter,{preventEvent:!0}),i?Ai(e).then((()=>{n.publish("pointConnectionsDraw"),io=!0,ao=t.showReticleOnce})).then(o):l()}))):l()})).then((()=>{t.transition&&r?(i?Promise.all([new Promise((e=>{n.subscribe("transitionEnd",(()=>{io=!0,ao=t.showReticleOnce,e()}),1)})),new Promise((e=>{n.subscribe("pointConnectionsDraw",e,1)}))]).then(o):n.subscribe("transitionEnd",(()=>{io=!0,ao=t.showReticleOnce,o()}),1),Di({duration:t.transitionDuration,easing:t.transitionEasing})):(i?Promise.all([new Promise((e=>{n.subscribe("draw",e,1)})),new Promise((e=>{n.subscribe("pointConnectionsDraw",e,1)}))]).then(o):n.subscribe("draw",o,1),io=!0,ao=t.showReticleOnce)}))})))),drawAnnotations:Bi,filter:Ii,get:e=>(hn({property:!0}),"aspectRatio"===e?no:"background"===e||"backgroundColor"===e?d:"backgroundImage"===e?u:"camera"===e?En:"cameraTarget"===e?En.target:"cameraDistance"===e?En.distance[0]:"cameraRotation"===e?En.rotation:"cameraView"===e?En.view:"canvas"===e?f:"colorBy"===e?v:"sizeBy"===e?Zt:"deselectOnDblClick"===e?w:"deselectOnEscape"===e?x:"height"===e?Ut:"lassoColor"===e?E:"lassoLineWidth"===e?S:"lassoMinDelay"===e?A:"lassoMinDist"===e?I:"lassoClearEvent"===e?P:"lassoInitiator"===e?M:"lassoInitiatorElement"===e?lr.initiator:"lassoInitiatorParentElement"===e?C:"keyMap"===e?{...be}:"mouseMode"===e?st:"opacity"===e?1===Dt.length?Dt[0]:Dt:"opacityBy"===e?Bt:"opacityByDensityFill"===e?zt:"opacityByDensityDebounceTime"===e?xn:"opacityInactiveMax"===e?$t:"opacityInactiveScale"===e?Ft:"points"===e?Xn:"hoveredPoint"===e?Ao:"selectedPoints"===e?[...Ln]:"filteredPoints"===e?On?Array.from(zn):Array.from({length:Xn.length},((e,t)=>t)):"pointsInView"===e?Pi():"pointColor"===e?1===pt.length?pt[0]:pt:"pointColorActive"===e?1===mt.length?mt[0]:mt:"pointColorHover"===e?1===ht.length?ht[0]:ht:"pointOutlineWidth"===e?Lt:"pointSize"===e?1===Ct.length?Ct[0]:Ct:"pointSizeSelected"===e?Tt:"pointSizeMouseDetection"===e?Rt:"showPointConnections"===e?ft:"pointConnectionColor"===e?1===yt.length?yt[0]:yt:"pointConnectionColorActive"===e?1===gt.length?gt[0]:gt:"pointConnectionColorHover"===e?1===vt.length?vt[0]:vt:"pointConnectionColorBy"===e?wt:"pointConnectionOpacity"===e?1===xt.length?xt[0]:xt:"pointConnectionOpacityBy"===e?bt:"pointConnectionOpacityActive"===e?Et:"pointConnectionSize"===e?1===St.length?St[0]:St:"pointConnectionSizeActive"===e?At:"pointConnectionSizeBy"===e?It:"pointConnectionMaxIntPointsPerSegment"===e?Pt:"pointConnectionTolerance"===e?Mt:"reticleColor"===e?ut:"regl"===e?c.regl:"showReticle"===e?lt:"version"===e?"1.10.4":"width"===e?Kt:"xScale"===e?ko:"yScale"===e?_o:"performanceMode"===e?wn:"gamma"===e?c.gamma:"renderer"===e?c:"isDestroyed"===e?In:"isPointsDrawn"===e?Bo:"isPointsFiltered"===e?On:"isAnnotationsDrawn"===e?Oo:"zDataType"===e?$o:"wDataType"===e?No:"spatialIndex"===e?$n?.data:"annotationLineColor"===e?qt:"annotationLineWidth"===e?un:"annotationHVLineLimit"===e?mn:void 0),getScreenPosition:e=>{if(!Bo)throw new Error(dt);const t=Xn[e];if(!t)return;const n=[t[0],t[1],0,1];h(i,Fn,h(i,En.view,_n)),g(n,n,i);return[gn*(n[0]+1)/2,vn*(.5-n[1]/2)]},hover:ar,redraw:()=>{io=!0},refresh:c.refresh,reset:Oi((({preventEvent:e=!1}={})=>{Gi(),Ar(),e||n.publish("view",{view:En.view,camera:En,xScale:ko,yScale:_o})})),select:ir,set:Ui,export:()=>f.getContext("2d").getImageData(0,0,f.width,f.height),subscribe:n.subscribe,unfilter:({preventEvent:e=!1}={})=>(On=!1,zn.clear(),mo.subdata(gi(Jn)),new Promise((t=>{const o=()=>{n.subscribe("draw",(()=>{e||n.publish("unfilter"),t()}),1),io=!0};ft||er(Xn[0])?Ai(qo()).then((()=>{e||n.publish("pointConnectionsDraw"),o()})):o()}))),unsubscribe:n.unsubscribe,view:(e,{preventEvent:t=!1}={})=>{_i(e),io=!0,ro=t},zoomToLocation:$i,zoomToArea:zi,zoomToPoints:(e,t={})=>{if(!Bo)return Promise.reject(new Error(dt));const n=(e=>{let t=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,o=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const i of e){const[e,a]=Xn[i];t=Math.min(t,e),n=Math.max(n,e),o=Math.min(o,a),r=Math.max(r,a)}return{x:t,y:o,width:n-t,height:r-o}})(e),o=n.x+n.width/2,r=n.y+n.height/2,i=Ko(),a=1+(t.padding||0),s=Math.max(n.width,i)*a,l=Math.max(n.height,i)*a;return zi({x:o-s/2,y:r-l/2,width:s,height:l},t)},zoomToOrigin:(e={})=>$i([0,0],1,e)}},vn=(e,t)=>nn(e).then((e=>B(e,{useWorker:t}))).then((e=>e.data));export{zt as checkSupport,$t as createRegl,cn as createRenderer,vn as createSpatialIndex,Vt as createTextureFromUrl,gn as default};
